/*
* Kendo UI v2015.2.624 (http://www.telerik.com/kendo-ui)
* Copyright 2015 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
* 若您需要使用Kendo UI Professional，请联系版权人获得合法的授权或许可。
*/
!function(e,define){define(["./kendo.dom.min","./kendo.data.min"],e)}(function(){return function(e,t){function n(e){var n="string"==typeof e?[{name:e}]:e,i="[object Array]"===wt.call(n)?n:n!==t?[n]:[];return bt(i,function(e){return"string"==typeof e?{name:e}:{name:e.name,type:e.type}})}function i(e){var n="string"==typeof e?[{name:[e],expand:!1}]:e,i="[object Array]"===wt.call(n)?n:n!==t?[n]:[];return bt(i,function(e){return"string"==typeof e?{name:[e],expand:!1}:{name:"[object Array]"===wt.call(e.name)?e.name.slice():[e.name],expand:e.expand}})}function o(e,t,n,i){var r,s,a,l;if(n||(n=t),i||(i=0),l=n.members[i],l&&!l.measure){if(a=l.children,s=a.length,n===t?e[pt.stringify([l.name])]=!!s:s&&(e[pt.stringify(lt(n,i))]=!0),s)for(r=0;s>r;r++)o(e,t,a[r],i);o(e,t,n,i+1)}}function r(t){var n,i,r={};t.length&&o(r,t[0]),n=[];for(i in r)n.push({name:e.parseJSON(i),expand:r[i]});return n}function s(e,t){var n,i,o,r,s=t.tuples||[],a=s[0];if(a&&a.members.length>e.length)for(n=a.members,i=0;n.length>i;i++)if(!n[i].measure){for(o=!1,r=0;e.length>r;r++)if(0===O(e[r]).indexOf(n[i].hierarchy)){o=!0;break}o||e.push({name:[n[i].name],expand:!1})}}function a(e){var t,n=[],i=e.members;for(t=0;i.length>t;t++)i[t].measure||n.push({name:[i[t].name],expand:i[t].children.length>0});return n}function l(e,t,n){var o,r;return e=e||{},s(t,e),n.length>1&&t.push({name:"Measures",measure:!0,children:i(n)}),o={members:t},e.tuples&&(r=k(e.tuples,o),r.tuple&&(t=a(r.tuple))),t}function c(e,t,n,i,o,r,s){var a,l,c,d,h,u,f,p=0,g=t;for(l in n[i].aggregates)a=n[i].aggregates[l],d=o[l],h=r[l],a=d?d(a):a.accumulator,e[g]={ordinal:g,value:a,fmtValue:h?pt.format(h,a):a},++p,g+=s;u=n[i].items;for(c in u){f=u[c].index*p,f=g+f*s;for(l in u[c].aggregates)a=u[c].aggregates[l],d=o[l],h=r[l],a=d?d(a):a.accumulator,e[f]={ordinal:f,value:a,fmtValue:h?pt.format(h,a):a},f+=s}}function d(e,t,n,i,o,r){var s,a,l,c,d,h,u,f=0;for(a in n[i].aggregates)s=n[i].aggregates[a],c=o[a],d=r[a],s=c?c(s):s.accumulator,e[e.length]={ordinal:t++,value:s,fmtValue:d?pt.format(d,s):s},++f;h=n[i].items;for(l in h){u=h[l].index*f;for(a in h[l].aggregates)s=h[l].aggregates[a],c=o[a],d=r[a],s=c?c(s):s.accumulator,e[e.length]={ordinal:t+u++,value:s,fmtValue:d?pt.format(d,s):s}}}function h(e){var t=pt.getter(e.field,!0);return function(n,i){return e.aggregate(t(n.dataItem),i,n)}}function u(e){return"number"==typeof e&&!isNaN(e)}function f(e){return e&&e.getTime}function p(e,n,i){return e.tuples.length<_(n.tuples,i)?n:t}function g(e,t,n,i,o){var r,s,a,l=e.length,c=_(t,i),d=i.length||1;for(s=0;n>s;s++)for(r=0;l>r;r++)a=v(e[r],t)*d,a+=r%d,o[s*l+r].ordinal=s*c+a}function m(e,t,n,i,o){var r,s,a,l=e.length,c=(_(t,i),i.length||1);for(s=0;l>s;s++)for(a=v(e[s],t),a*=c,a+=s%c,r=0;n>r;r++)o[s*n+r].ordinal=a*n+r}function v(e,t){return k(t,e).index}function _(e,t){var n,i,o;if(!e.length)return 0;for(n=e.slice(),i=n.shift(),o=1;i;)i.members?[].push.apply(n,i.members):i.children&&(i.measure||(o+=i.children.length),[].push.apply(n,i.children)),i=n.shift();return t.length&&(o*=t.length),o}function w(e){return e||(e={tuples:[]}),e.tuples||(e.tuples=[]),e}function y(e,t,n){var i,o,r;if(!e)return 0;for(i=Math.max(n.length,1),o=e.members.slice(0,t),r=o.shift();r;)r.children?[].push.apply(o,r.children):(i++,[].push.apply(o,r.members)),r=o.shift();return i}function b(e,t,n){var i,o,r,s,a,l;if(!t[0])return{parsedRoot:null,tuples:e,memberIndex:0,index:0};if(i=k(e,t[0]),!i.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};if(o=i.tuple.members,r=t[0].members,s=-1,o.length!==r.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(a=0,l=o.length;l>a;a++)!o[a].measure&&r[a].children[0]&&(-1==s&&r[a].children.length&&(s=a),o[a].children=r[a].children);return n=Math.max(n.length,1),{parsedRoot:i.tuple,index:i.index*n,memberIndex:s,tuples:e}}function x(e,t){var n,i,o=!0;for(e=e.members,t=t.members,n=0,i=e.length;i>n;n++)e[n].measure||t[n].measure||(o=o&&O(e[n])===O(t[n]));return o}function k(e,t){var n,i,o,r,s,a,l,c=0;for(n=0,i=e.length;i>n;n++){if(o=e[n],x(o,t))return{tuple:o,index:c};for(c++,s=0,a=o.members.length;a>s;s++)if(l=o.members[s],!l.measure&&(r=k(l.children,t),c+=r.index,r.tuple))return{tuple:r.tuple,index:c}}return{index:c}}function C(e,t){var n,i,o,r="";for(i=0,o=e.length;o>i;i++)n=e[i],r+=n.name,t[r]||(t[r]=n)}function S(e,t){var n,i,o,r,s=e.members,a="",l="";for(n=0,i=s.length;i>n;n++){if(o=s[n],r){if(t[a+o.name]){a+=o.name,r=t[a];continue}return t[a+o.parentName]?t[a+o.parentName]:t[l+o.parentName]?t[l+o.parentName]:t[l]}if(a+=o.name,r=t[o.parentName],!r&&(r=t[a],!r))return null;r&&(l+=r.name)}return r}function T(e,t){var n,i,o,r;if(0===t.length)return-1;for(n=t[0],i=e.members,o=0,r=i.length;r>o;o++)if(i[o].name==n.name)return o}function D(n,i){if(!(0>i)){var o={name:"Measures",measure:!0,children:[e.extend({members:[],dataIndex:n.dataIndex},n.members[i])]};n.members.splice(i,1,o),n.dataIndex=t}}function A(e,t){var n,i,o,r,s,a;if(1>e.length)return[];for(n=[],i={},o=T(e[0],t),r=0;e.length>r;r++)s=e[r],s.dataIndex=r,D(s,o),a=S(s,i),a?a.children.push(0>o||!a.measure?s:s.members[o].children[0]):n.push(s),C(s.members,i);return n}function P(e,t){var n,i,o,r,s,a,l,c,d;if(!e||!e.length)return t;for(n=[],i=M(e),o=i.length,r=Math.max(t.length/o,1),s=0;o>s;s++)for(l=r*s,c=r*i[s],a=0;r>a;a++)d=parseInt(c+a,10),n[parseInt(l+a,10)]=t[d]||{value:"",fmtValue:"",ordinal:d};return n}function E(e,t){var n,i,o,r,s,a,l,c;if(!e||!e.length)return t;for(n=[],i=M(e),o=i.length,r=Math.max(t.length/o,1),a=0;r>a;a++)for(l=o*a,s=0;o>s;s++)c=i[s]+l,n[l+s]=t[c]||{value:"",fmtValue:"",ordinal:c};return n}function M(e){var n,i,o,r,s,a,l;for(e=e.slice(),n=[],i=e.shift();i;){for(i.dataIndex!==t&&n.push(i.dataIndex),s=0,o=0,r=i.members.length;r>o;o++)l=i.members[o],a=l.children,l.measure?[].splice.apply(e,[0,0].concat(a)):[].splice.apply(e,[s,0].concat(a)),s+=a.length;i=e.shift()}return n}function I(e){var t=e.split(".");return t.length>2?t[0]+"."+t[1]:e}function B(e,t){var n=e.length-1,i=e[n],o=z(t,i);return o&&o.dir?i="ORDER("+i+".Children,"+o.field+".CurrentMember.MEMBER_CAPTION,"+o.dir+")":i+=".Children",e[n]=i,e}function z(e,t){for(var n=0,i=e.length;i>n;n++)if(0===t.indexOf(e[n].field))return e[n];return null}function L(e){var t,n="CROSSJOIN({";return e.length>2?(t=e.pop(),n+=L(e)):(n+=e.shift(),t=e.pop()),n+="},{",n+=t,n+="})"}function F(e,t){var n=e.slice(0);return t.length>1&&n.push("{"+R(t).join(",")+"}"),L(n)}function R(e){for(var n,i=0,o=e.length,r=[];o>i;i++)n=e[i],r.push(n.name!==t?n.name:n);return r}function O(e){return e=e.name||e,"[object Array]"===wt.call(e)&&(e=e[e.length-1]),e}function N(e){for(var t=e.length,n=[],i=0;t>i;i++)n.push(e[i].name[0]);return n}function H(e,t){var n,i,o,r=0,s=e.length,a=t.length;for(t=t.slice(0);s>r;r++)for(n=e[r],o=0;a>o;o++)if(i=I(t[o]),-1!==n.indexOf(i)){t[o]=n;break}return t}function V(e){for(var t,n,i,o,r,s,a=[],l=[],c=[],d=0,h=e.length;h>d;d++)if(t=e[d],o=t.name,s=!1,"[object Array]"!==wt.call(o)&&(t.name=o=[o]),o.length>1)l.push(t);else{for(r=I(o[0]),n=0,i=c.length;i>n;n++)if(0===c[n].name[0].indexOf(r)){s=!0;break}s||c.push(t),t.expand&&a.push(t)}return a=a.concat(l),{root:c,expanded:a}}function U(e,t,n){var i,o,r,s,a,l,c,d,h="";if(e=e||[],i=V(e),o=i.root,r=N(o),s=[],i=i.expanded,a=i.length,l=0,d=[],r.length>1||t.length>1){for(s.push(F(r,t));a>l;l++)c=B(i[l].name,n),d=H(c,r),s.push(F(d,t));h+=s.join(",")}else{for(;a>l;l++)c=B(i[l].name,n),d.push(c[0]);h+=r.concat(d).join(",")}return h}function W(e){var t="",n=e.value,i=e.field,o=e.operator;return"in"==o?(t+="{",t+=n,t+="}"):(t+="Filter(",t+=i+".MEMBERS",t+=pt.format(Y[o],i,n),t+=")"),t}function j(e,t){var n,i,o="",r=e.filters,s=r.length;for(i=s-1;i>=0;i--)n="SELECT (",n+=W(r[i]),n+=") ON 0",i==s-1?(n+=" FROM ["+t+"]",o=n):o=n+" FROM ( "+o+" )";return o}function G(e,t,n){var i,o,r="";if(t){r+="<"+e+">";for(o in t)i=t[o],n&&(o=o.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),r+="<"+o+">"+i+"</"+o+">";r+="</"+e+">"}else r+="<"+e+"/>";return r}function q(e){if(null==e)return[];var t=wt.call(e);return"[object Array]"!==t?[e]:e}function $(e){var t,n,i,o,r={tuples:[]},s=q(pt.getter("Tuples.Tuple",!0)(e)),a=pt.getter("Caption['#text']"),l=pt.getter("UName['#text']"),c=pt.getter("LName['#text']"),d=pt.getter("LNum['#text']"),h=pt.getter("CHILDREN_CARDINALITY['#text']",!0),u=pt.getter("['@Hierarchy']"),f=pt.getter("PARENT_UNIQUE_NAME['#text']",!0);for(t=0;s.length>t;t++){for(n=[],i=q(s[t].Member),o=0;i.length>o;o++)n.push({children:[],caption:a(i[o]),name:l(i[o]),levelName:c(i[o]),levelNum:d(i[o]),hasChildren:parseInt(h(i[o]),10)>0,parentName:f(i[o]),hierarchy:u(i[o])});r.tuples.push({members:n})}return r}var Y,Q,X,K,Z,J,et,tt,nt,it,ot,rt,st,at,lt,ct,dt,ht,ut,ft,pt=window.kendo,gt=pt.ui,mt=pt.Class,vt=gt.Widget,_t=pt.data.DataSource,wt={}.toString,yt=function(e){return e},bt=e.map,xt=e.extend,kt=pt.isFunction,Ct="change",St="error",Tt="progress",Dt="stateReset",At="auto",Pt="<div/>",Et=".kendoPivotGrid",Mt="__row_total__",It="dataBinding",Bt="dataBound",zt="expandMember",Lt="collapseMember",Ft="k-i-arrow-s",Rt="k-i-arrow-e",Ot="<span>#: data.member.caption || data.member.name #</span>",Nt='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "open" : data.dataItem.value < 0 ? "denied" : "hold"#">#:data.dataItem.value#</span>',Ht='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "increase" : data.dataItem.value < 0 ? "decrease" : "equal"#">#:data.dataItem.value#</span>',Vt='#= data.dataItem ? kendo.htmlEncode(data.dataItem.fmtValue || data.dataItem.value) || "&nbsp;" : "&nbsp;" #',Ut='<table class="k-pivot-layout"><tr><td><div class="k-pivot-rowheaders"></div></td><td><div class="k-pivot-table k-state-default"></div></td></tr></table>',Wt={sum:function(e,t){var n=t.accumulator;return u(n)?u(e)&&(n+=e):n=e,n},count:function(e,t){return(t.accumulator||0)+1},average:{aggregate:function(e,n){var i=n.accumulator;return n.count===t&&(n.count=0),u(i)?u(e)&&(i+=e):i=e,u(e)&&n.count++,i},result:function(e){var t=e.accumulator;return u(t)&&(t/=e.count),t}},max:function(e,t){var n=t.accumulator;return u(n)||f(n)||(n=e),e>n&&(u(e)||f(e))&&(n=e),n},min:function(e,t){var n=t.accumulator;return u(n)||f(n)||(n=e),n>e&&(u(e)||f(e))&&(n=e),n}},jt=mt.extend({init:function(e){this.options=xt({},this.options,e),this.dimensions=this._normalizeDescriptors("field",this.options.dimensions),this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(e,t){var n,i,o,r;if(t=t||{},n={},"[object Array]"===wt.call(t)){for(o=0,r=t.length;r>o;o++)i=t[o],"string"==typeof i?n[i]={}:i[e]&&(n[i[e]]=i);t=n}return t},_asTuples:function(e,n,i){var o,r,s,a,l,c,d,h,u,f;if(i=i||[],o=this.dimensions||[],r=[],u=i.length||1,n.length||i.length)for(c=0;u>c;c++){for(s={members:[]},a=0,l=n.length;l>a;a++)h=O(n[a].name),s.members[s.members.length]={children:[],caption:(o[h]||{}).caption||"All",name:h,levelName:h,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:h};u>1&&(s.members[s.members.length]={children:[],caption:i[c].caption,name:i[c].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!1,parentName:t,hierarchy:"MEASURES"}),r[r.length]=s}for(f in e)for(c=0;u>c;c++){for(d={members:[]},a=0,l=n.length;l>a;a++)h=O(n[a].name),d.members[d.members.length]=0===e[f].parentName.indexOf(h)?{children:[],caption:e[f].value,name:e[f].name,levelName:e[f].name,levelNum:1,hasChildren:!1,parentName:h,hierarchy:h}:{children:[],caption:(o[h]||{}).caption||"All",name:h,levelName:h,levelNum:"0",hasChildren:!0,parentName:t,hierarchy:h};u>1&&(d.members[d.members.length]={children:[],caption:i[c].caption,name:i[c].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!0,parentName:t,hierarchy:"MEASURES"}),r[r.length]=d}return r},_toDataArray:function(e,t,n,i,o){var r,s,a,l,c,d,h={},u={},f=0,p=n&&n.length;if(p)for(r=this.measures||{};p>f;f++)a=n[f].name,s=r[a],s.result&&(u[a]=s.result),s.format&&(h[a]=s.format);l=[],c=0,o(l,c,e,Mt,u,h,t);for(d in e)d!==Mt&&(c+=i,o(l,c,e,d,u,h,t));return l},_matchDescriptors:function(e,t,n,i){for(var o,r,s,a,l;i>0;)if(o=t[--i],r=O(o).split("&"),r.length>1&&(s=r[0],a=r[1],l=n[s],l(e)!=a))return!1;return!0},_isExpanded:function(e){for(var t=0,n=e.length;n>t;t++)if(e[t].expand)return!0;return!1},_calculateAggregate:function(e,t,n){var i,o,r,s={};for(r=0;e.length>r;r++)o=e[r].descriptor.name,i=n.aggregates[o]||{},i.accumulator=e[r].aggregator(t,i),s[o]=i;return s},_processColumns:function(e,n,i,o,r,s,a,l){var c,d,h,u,f,p,g=r.dataItem;for(p=0;n.length>p;p++)if(d=n[p],d.expand){if(!this._matchDescriptors(g,n,i,p))continue;h=O(d),c=i[h](g),c=c!==t&&null!==c?""+c:c,h=h+"&"+c,u=o[h]||{index:a.columnIndex,name:h,parentName:h,value:c},f=s.items[h]||{aggregates:{}},s.items[h]={index:u.index,aggregates:this._calculateAggregate(e,r,f)},l&&(o[h]||a.columnIndex++,o[h]=u)}},_measureAggregators:function(e){var t,n,i,o,r,s,a=e.measures||[],l=this.measures||{},c=[];if(a.length){for(i=0,o=a.length;o>i;i++)if(t=a[i],n=l[t.name],r=null,n){if(s=n.aggregate,"string"==typeof s){if(r=Wt[s.toLowerCase()],!r)throw Error("There is no such aggregate function");n.aggregate=r.aggregate||r,n.result=r.result}c.push({descriptor:t,caption:n.caption,result:n.result,aggregator:h(n)})}}else c.push({descriptor:{name:"default"},caption:"default",aggregator:function(){return 1}});return c},_normalizeName:function(e){return-1!==e.indexOf(" ")&&(e='["'+e+'"]'),e},_buildGetters:function(e){var t,n,i,o,r,s={};for(o=0,r=e.length;r>o;o++)t=e[o],i=O(t),n=i.split("&"),n.length>1?s[n[0]]=pt.getter(n[0],!0):s[i]=pt.getter(this._normalizeName(i),!0);return s},process:function(e,n){var o,r,s,a,l,h,u,f,p,g,m,v,_,w,y,b,x,k,C,S,T,D,A,P,E,M;if(e=e||[],n=n||{},o=n.measures||[],r="rows"===n.measuresAxis,s=(r?n.rows:n.columns)||[],a=(r?n.columns:n.rows)||[],!s.length&&a.length&&(!o.length||o.length&&r)&&(s=a,a=[],r=!1),s.length||a.length||(r=!1),!s.length&&o.length&&(s=i(n.measures)),l={},h={},u={},p={columnIndex:0},g=this._measureAggregators(n),m=this._buildGetters(s),v=this._buildGetters(a),_=!1,s.length||a.length)for(b=this._isExpanded(a),_=!0,x=0,k=e.length;k>x;x++)for(w=e[x],y={dataItem:w,index:x},C=l[Mt]||{items:{},aggregates:{}},this._processColumns(g,s,m,h,y,C,p,!b),C.aggregates=this._calculateAggregate(g,y,C),l[Mt]=C,S=0,T=a.length;T>S;S++)if(D=a[S],D.expand){if(!this._matchDescriptors(w,a,v,S))continue;A=O(D),f=v[A](w),f=f!==t?""+f:f,u[f]={name:A+"&"+f,parentName:A,value:f},P=l[f]||{items:{},aggregates:{}},this._processColumns(g,s,m,h,y,P,p,!0),P.aggregates=this._calculateAggregate(g,y,P),l[f]=P}return _&&e.length?(!(g.length>1)||n.columns&&n.columns.length||(s=[]),h=this._asTuples(h,s,g),u=this._asTuples(u,a,[]),E=h.length,r&&(E=1,M=h,h=u,u=M),l=this._toDataArray(l,h.length,n.measures,E,r?c:d),l=this._normalizeData(l,h.length,u.length)):l=h=u=[],{axes:{columns:{tuples:h},rows:{tuples:u}},data:l}},_normalizeData:function(e,t,n){var i,o,r=(t||1)*(n||1),s=Array(r),a=e.length;if(a===r)return e;for(o=0;r>o;o++)s[o]={value:"",fmtValue:"",ordinal:o};for(o=0;a>o;o++)i=e[o],i&&(s[i.ordinal]=i);return s}}),Gt=mt.extend({init:function(e,t){this.transport=t,this.options=t.options||{},this.transport.discover||kt(e.discover)&&(this.discover=e.discover)},read:function(e){return this.transport.read(e)},update:function(e){return this.transport.update(e)},create:function(e){return this.transport.create(e)},destroy:function(e){return this.transport.destroy(e)},discover:function(e){return this.transport.discover?this.transport.discover(e):(e.success({}),t)},catalog:function(n){var i,o=this.options||{};return n===t?(o.connection||{}).catalog:(i=o.connection||{},i.catalog=n,this.options.connection=i,e.extend(this.transport.options,{connection:i}),t)},cube:function(e){var n,i=this.options||{};return e===t?(i.connection||{}).cube:(n=i.connection||{},n.cube=e,this.options.connection=n,xt(!0,this.transport.options,{connection:n}),t)}}),qt=_t.extend({init:function(t){var o,r=((t||{}).schema||{}).cube,s="columns",a={axes:yt,cubes:yt,catalogs:yt,measures:yt,dimensions:yt,hierarchies:yt,levels:yt,members:yt};r&&(a=e.extend(a,this._cubeSchema(r)),this.cubeBuilder=new jt(r)),_t.fn.init.call(this,xt(!0,{},{schema:a},t)),this.transport=new Gt(this.options.transport||{},this.transport),this._columns=i(this.options.columns),this._rows=i(this.options.rows),o=this.options.measures||[],"[object Object]"===wt.call(o)&&(s=o.axis||"columns",o=o.values||[]),this._measures=n(o),this._measuresAxis=s,this._skipNormalize=0,this._axes={}},_cubeSchema:function(e){return{dimensions:function(){var t,n=[],i=e.dimensions;for(t in i)n.push({name:t,caption:i[t].caption||t,uniqueName:t,defaultHierarchy:t,type:1});return e.measures&&n.push({name:"Measures",caption:"Measures",uniqueName:"Measures",type:2}),n},hierarchies:function(){return[]},measures:function(){var t,n=[],i=e.measures;for(t in i)n.push({name:t,caption:t,uniqueName:t,aggregator:t});return n}}},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},catalog:function(e){return e===t?this.transport.catalog():(this.transport.catalog(e),this._mergeState({}),this._axes={},this.data([]),t)},cube:function(e){return e===t?this.transport.cube():(this.transport.cube(e),this._axes={},this._mergeState({}),this.data([]),t)},axes:function(){return this._axes},columns:function(e){return e===t?this._columns:(this._skipNormalize+=1,this._clearAxesData=!0,this._columns=i(e),this.query({columns:e,rows:this.rowsAxisDescriptors(),measures:this.measures()}),t)},rows:function(e){return e===t?this._rows:(this._skipNormalize+=1,this._clearAxesData=!0,this._rows=i(e),this.query({columns:this.columnsAxisDescriptors(),rows:e,measures:this.measures()}),t)},measures:function(e){return e===t?this._measures:(this._skipNormalize+=1,this._clearAxesData=!0,this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:n(e)}),t)},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(e,t){var n,o,r,s="columns"===t?"columns":"rows",a="columns"===t?"rows":"columns",c=i(e),d=O(c[c.length-1]);for(this._lastExpanded=s,c=l(this.axes()[s],c,this.measures()),n=0;c.length>n;n++)if(o=O(c[n]),o===d){if(c[n].expand)return;c[n].expand=!0}else c[n].expand=!1;r={},r[s]=c,r[a]=this._descriptorsForAxis(a),this._query(r)},_descriptorsForAxis:function(e){var t=this.axes(),n=this[e]()||[];return t&&t[e]&&t[e].tuples&&t[e].tuples[0]&&(n=r(t[e].tuples||[])),n},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(e,t){this._view=e,t=t||{},t.items=t.items||this._view,this.trigger(Ct,t)},_query:function(e){var t=this;return e||(this._skipNormalize+=1,this._clearAxesData=!0),t.query(xt({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},e))},query:function(t){var n=this._mergeState(t);return this._data.length&&this.cubeBuilder?(this._params(n),this._updateLocalData(this._pristineData),e.Deferred().resolve().promise()):this.read(n)},_mergeState:function(e){return e=_t.fn._mergeState.call(this,e),e!==t&&(this._measures=n(e.measures),e.columns?e.columns=i(e.columns):e.columns||(this._columns=[]),e.rows?e.rows=i(e.rows):e.rows||(this._rows=[])),e},filter:function(e){return e===t?this._filter:(this._skipNormalize+=1,this._clearAxesData=!0,this._query({filter:e,page:1}),t)},expandColumn:function(e){this._expandPath(e,"columns")},expandRow:function(e){this._expandPath(e,"rows")},success:function(e){var t;this.cubeBuilder&&(t=(this.reader.data(e)||[]).slice(0)),_t.fn.success.call(this,e),t&&(this._pristineData=t)},_processResult:function(e,t){var n,i,o,r,s,a,l,c,d,h,u;return this.cubeBuilder&&(n=this.cubeBuilder.process(e,this._requestData),e=n.data,t=n.axes),c=this.columns(),d=this.rows(),h=t.columns&&t.columns.tuples,c.length||!d.length||!h||!this._rowMeasures().length&&this.measures().length||(t={columns:{},rows:t.columns}),c.length||d.length||"rows"!==this.measuresAxis()||!h||(t={columns:{},rows:t.columns}),this._axes={columns:w(this._axes.columns),rows:w(this._axes.rows)},t={columns:w(t.columns),rows:w(t.rows)},i=this._normalizeTuples(t.columns.tuples,this._axes.columns.tuples,c,this._columnMeasures()),o=this._normalizeTuples(t.rows.tuples,this._axes.rows.tuples,d,this._rowMeasures()),this._skipNormalize-=1,this.cubeBuilder||(e=this._normalizeData({columnsLength:t.columns.tuples.length,rowsLength:t.rows.tuples.length,columnIndexes:i,rowIndexes:o,data:e})),"rows"==this._lastExpanded?(r=t.columns.tuples,a=this._columnMeasures(),s=p(t.columns,this._axes.columns,a),s&&(l="columns",t.columns=s,g(r,s.tuples,t.rows.tuples.length,a,e),e=this._normalizeData({columnsLength:_(t.columns.tuples,a),rowsLength:t.rows.tuples.length,data:e}))):"columns"==this._lastExpanded&&(r=t.rows.tuples,a=this._rowMeasures(),s=p(t.rows,this._axes.rows,a),s&&(l="rows",t.rows=s,m(r,s.tuples,t.columns.tuples.length,a,e),e=this._normalizeData({columnsLength:_(t.rows.tuples,a),rowsLength:t.columns.tuples.length,data:e}))),this._lastExpanded=null,u=this._mergeAxes(t,e,l),this._axes=u.axes,u.data},_readData:function(e){var t=this.reader.axes(e),n=this.reader.data(e);return this._processResult(n,t)},_createTuple:function(e,t,n){var i,o,r,s,a,l,c,d,h=e.members,u=h.length,f={members:[]},p=0;for(t&&(u-=1);u>p;p++)d=h[p],o=+d.levelNum,r=d.name,s=d.parentName,c=d.caption||r,a=d.hasChildren,l=d.hierarchy,i=d.levelName,n&&(c="All",0===o?s=d.name:o-=1,a=!0,r=l=i=s),f.members.push({name:r,children:[],caption:c,levelName:i,levelNum:""+o,hasChildren:a,hierarchy:l,parentName:n?"":s});return t&&f.members.push({name:t.name,children:[]}),f},_hasRoot:function(e,t,n){var i,o,r,s,a,l,c;if(t.length)return k(t,e).tuple;for(i=e.members,s=!0,l=0,c=i.length;c>l;l++)if(o=i[l],a=+o.levelNum||0,r=n[l],!(0===a||r&&o.name===O(r))){s=!1;break}return s},_mergeAxes:function(e,t,n){var i,o,r,s,a,l=this._columnMeasures(),c=this._rowMeasures(),d=this.axes(),h=e.rows.tuples.length,u=_(d.columns.tuples,l),f=e.columns.tuples.length;return"columns"==n?(f=u,o=e.columns.tuples):(o=A(e.columns.tuples,l),t=E(o,t)),r=b(d.columns.tuples,o,l),"rows"==n?(h=_(e.rows.tuples,c),o=e.rows.tuples):(o=A(e.rows.tuples,c),t=P(o,t)),s=b(d.rows.tuples,o,c),d.columns.tuples=r.tuples,d.rows.tuples=s.tuples,u!==_(d.columns.tuples,l)?(i=r.index+y(r.parsedRoot,r.memberIndex,l),a=u+f,t=this._mergeColumnData(t,i,h,f,a)):(i=s.index+y(s.parsedRoot,s.memberIndex,c),t=this._mergeRowData(t,i,h,f)),{axes:d,data:t}},_mergeColumnData:function(e,t,n,i,o){var r,s,a,l=this.data().toJSON(),c=0,d=Math.max(this._columnMeasures().length,1);for(n=Math.max(n,1),l.length>0&&(c=d,o-=d),r=0;n>r;r++)s=t+r*o,a=e.splice(0,i),a.splice(0,c),[].splice.apply(l,[s,0].concat(a));return l},_mergeRowData:function(e,t,n,i){var o,r,s,a=this.data().toJSON(),l=Math.max(this._rowMeasures().length,1);for(i=Math.max(i,1),a.length>0&&(n-=l,e.splice(0,i*l)),o=0;n>o;o++)s=e.splice(0,i),r=t*i+o*i,[].splice.apply(a,[r,0].concat(s));return a},_columnMeasures:function(){var e=this.measures(),t=[];return"columns"===this.measuresAxis()&&(0===this.columns().length?t=e:e.length>1&&(t=e)),t},_rowMeasures:function(){var e=this.measures(),t=[];return"rows"===this.measuresAxis()&&(0===this.rows().length?t=e:e.length>1&&(t=e)),t},_updateLocalData:function(e,t){this.cubeBuilder&&(t&&(this._requestData=t),e=this._processResult(e)),this._data=this._observe(e),this._ranges=[],this._addRange(this._data),this._total=this._data.length,this._pristineTotal=this._total,this._process(this._data)},data:function(e){var n=this;return e===t?n._data:(this._pristineData=e.slice(0),this._updateLocalData(e,{columns:this.columns(),rows:this.rows(),measures:this.measures()}),t)},_normalizeTuples:function(e,t,n,i){var o,r,s,a=i.length||1,l=0,c=[],d={},h=0;if(e.length){if(0>=this._skipNormalize&&!this._hasRoot(e[0],t,n)){for(this._skipNormalize=0;a>l;l++)c.push(this._createTuple(e[0],i[l],!0)),d[l]=l;e.splice.apply(e,[0,e.length].concat(c).concat(e)),l=a}if(i.length)for(s=o=e[l],r=o.members.length-1;o;){if(h>=a&&(h=0),o.members[r].name!==i[h].name&&(e.splice(l,0,this._createTuple(o,i[h])),d[l]=l),l+=1,h+=1,o=e[l],a>h&&(!o||ct(s,r-1)!==ct(o,r-1))){for(;a>h;h++)e.splice(l,0,this._createTuple(s,i[h])),d[l]=l,l+=1;o=e[l]}s=o}return d}},_normalizeData:function(e){var n,i,o=e.data,r=e.columnIndexes||{},s=e.rowIndexes||{},a=e.columnsLength||1,l=a*(e.rowsLength||1),c=0,d=0,h=0,u=Array(l);if(o.length===l)return o;for(;l>c;c++){for(;s[parseInt(c/a,10)]!==t;)for(i=0;a>i;i++)u[c]={value:"",fmtValue:"",ordinal:c},c+=1;for(;r[c%a]!==t;)u[c]={value:"",fmtValue:"",ordinal:c},c+=1;if(n=o[d]){if(n.ordinal-h>1)for(h+=1;n.ordinal>h;h++)u[c]={value:"",fmtValue:"",ordinal:c},c+=1;h=n.ordinal,n.ordinal=c,u[c]=n,d+=1}else u[c]={value:"",fmtValue:"",ordinal:c}}return u},discover:function(t,n){var i=this,o=i.transport;return e.Deferred(function(e){o.discover(xt({success:function(t){t=i.reader.parse(t),i._handleCustomErrors(t)||(n&&(t=n(t)),e.resolve(t))},error:function(t,n,o){e.reject(t),i.error(t,n,o)}},t))}).promise().done(function(){i.trigger("schemaChange")})},schemaMeasures:function(){var e=this;return e.discover({data:{command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.measures(t)})},schemaKPIs:function(){var e=this;return e.discover({data:{command:"schemaKPIs",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.kpis(t)})},schemaDimensions:function(){var e=this;return e.discover({data:{command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.dimensions(t)})},schemaHierarchies:function(e){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}}},function(e){return t.reader.hierarchies(e)})},schemaLevels:function(e){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}}},function(e){return t.reader.levels(e)})},schemaCubes:function(){var e=this;return e.discover({data:{command:"schemaCubes",restrictions:{catalogName:e.transport.catalog()}}},function(t){return e.reader.cubes(t)})},schemaCatalogs:function(){var e=this;return e.discover({data:{command:"schemaCatalogs"}},function(t){return e.reader.catalogs(t)})},schemaMembers:function(e){var t=this;return t.discover({data:{command:"schemaMembers",restrictions:xt({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)}},function(e){return t.reader.members(e)})},_params:function(e){this._clearAxesData&&(this._axes={},this._data=this._observe([]),this._clearAxesData=!1,this.trigger(Dt));var t=_t.fn._params.call(this,e);return t=xt({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t),this.cubeBuilder&&(this._requestData=t),t}});qt.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},n=t.data;if(t.data=n,!(t instanceof qt)&&t instanceof pt.data.DataSource)throw Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof qt?t:new qt(t)},Y={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") = 0',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', NOT {0}.CurrentMember.MEMBER_CAPTION = "{1}"'},Q={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS",schemaKPIs:"MDSCHEMA_KPIS"},X={read:function(e){var t,n,i,o,r,s='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>';return s+="SELECT NON EMPTY {",t=e.columns||[],n=e.rows||[],i=e.measures||[],o="rows"===e.measuresAxis,r=e.sort||[],!t.length&&n.length&&(!i.length||i.length&&o)&&(t=n,n=[],o=!1),t.length||n.length||(o=!1),t.length?s+=U(t,o?[]:i,r):i.length&&!o&&(s+=R(i).join(",")),s+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(n.length||o&&i.length>1)&&(s+=", NON EMPTY {",s+=n.length?U(n,o?i:[],r):R(i).join(","),s+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),e.filter?(s+=" FROM ",s+="(",s+=j(e.filter,e.connection.cube),s+=")"):s+=" FROM ["+e.connection.cube+"]",1==i.length&&t.length&&(s+=" WHERE ("+R(i).join(",")+")"),s+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>",s.replace(/\&/g,"&amp;")},discover:function(t){t=t||{};var n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return n+="<RequestType>"+(Q[t.command]||t.command)+"</RequestType>",n+="<Restrictions>"+G("RestrictionList",t.restrictions,!0)+"</Restrictions>",t.connection&&t.connection.catalog&&(t.properties=e.extend({},{Catalog:t.connection.catalog},t.properties)),n+="<Properties>"+G("PropertyList",t.properties)+"</Properties>",n+="</Discover></Body></Envelope>"}},K=pt.data.RemoteTransport.extend({init:function(e){var t=e;e=this.options=xt(!0,{},this.options,e),pt.data.RemoteTransport.call(this,e),kt(t.discover)?this.discover=t.discover:"string"==typeof t.discover?this.options.discover={url:t.discover}:t.discover||(this.options.discover=this.options.read)},setup:function(t,n){return t.data=t.data||{},e.extend(!0,t.data,{connection:this.options.connection}),pt.data.RemoteTransport.fn.setup.call(this,t,n)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(e,t){return X[t](e,t)}},discover:function(t){return e.ajax(this.setup(t,"discover"))}}),Z={cubes:{name:pt.getter("CUBE_NAME['#text']",!0),caption:pt.getter("CUBE_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),type:pt.getter("CUBE_TYPE['#text']",!0)},catalogs:{name:pt.getter("CATALOG_NAME['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0)},measures:{name:pt.getter("MEASURE_NAME['#text']",!0),caption:pt.getter("MEASURE_CAPTION['#text']",!0),uniqueName:pt.getter("MEASURE_UNIQUE_NAME['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),aggregator:pt.getter("MEASURE_AGGREGATOR['#text']",!0),groupName:pt.getter("MEASUREGROUP_NAME['#text']",!0),displayFolder:pt.getter("MEASURE_DISPLAY_FOLDER['#text']",!0),defaultFormat:pt.getter("DEFAULT_FORMAT_STRING['#text']",!0)},kpis:{name:pt.getter("KPI_NAME['#text']",!0),caption:pt.getter("KPI_CAPTION['#text']",!0),value:pt.getter("KPI_VALUE['#text']",!0),goal:pt.getter("KPI_GOAL['#text']",!0),status:pt.getter("KPI_STATUS['#text']",!0),trend:pt.getter("KPI_TREND['#text']",!0),statusGraphic:pt.getter("KPI_STATUS_GRAPHIC['#text']",!0),trendGraphic:pt.getter("KPI_TREND_GRAPHIC['#text']",!0),description:pt.getter("KPI_DESCRIPTION['#text']",!0),groupName:pt.getter("MEASUREGROUP_NAME['#text']",!0)},dimensions:{name:pt.getter("DIMENSION_NAME['#text']",!0),caption:pt.getter("DIMENSION_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),uniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),defaultHierarchy:pt.getter("DEFAULT_HIERARCHY['#text']",!0),type:pt.getter("DIMENSION_TYPE['#text']",!0)},hierarchies:{name:pt.getter("HIERARCHY_NAME['#text']",!0),caption:pt.getter("HIERARCHY_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),uniqueName:pt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),dimensionUniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:pt.getter("HIERARCHY_DISPLAY_FOLDER['#text']",!0),origin:pt.getter("HIERARCHY_ORIGIN['#text']",!0),defaultMember:pt.getter("DEFAULT_MEMBER['#text']",!0)},levels:{name:pt.getter("LEVEL_NAME['#text']",!0),caption:pt.getter("LEVEL_CAPTION['#text']",!0),description:pt.getter("DESCRIPTION['#text']",!0),uniqueName:pt.getter("LEVEL_UNIQUE_NAME['#text']",!0),dimensionUniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:pt.getter("LEVEL_DISPLAY_FOLDER['#text']",!0),orderingProperty:pt.getter("LEVEL_ORDERING_PROPERTY['#text']",!0),origin:pt.getter("LEVEL_ORIGIN['#text']",!0),hierarchyUniqueName:pt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0)},members:{name:pt.getter("MEMBER_NAME['#text']",!0),caption:pt.getter("MEMBER_CAPTION['#text']",!0),uniqueName:pt.getter("MEMBER_UNIQUE_NAME['#text']",!0),dimensionUniqueName:pt.getter("DIMENSION_UNIQUE_NAME['#text']",!0),hierarchyUniqueName:pt.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),levelUniqueName:pt.getter("LEVEL_UNIQUE_NAME['#text']",!0),childrenCardinality:pt.getter("CHILDREN_CARDINALITY['#text']",!0)}},J=["axes","catalogs","cubes","dimensions","hierarchies","levels","measures"],et=pt.data.XmlDataReader.extend({init:function(e){pt.data.XmlDataReader.call(this,e),this._extend(e)
},_extend:function(e){for(var t,n,i=0,o=J.length;o>i;i++)t=J[i],n=e[t],n&&n!==yt&&(this[t]=n)},parse:function(e){var t=pt.data.XmlDataReader.fn.parse(e.replace(/<(\/?)(\w|-)+:/g,"<$1"));return pt.getter("['Envelope']['Body']",!0)(t)},errors:function(e){var t=pt.getter("['Fault']",!0)(e);return t?[{faultstring:pt.getter("faultstring['#text']",!0)(t),faultcode:pt.getter("faultcode['#text']",!0)(t)}]:null},axes:function(e){var t,n,i,o;for(e=pt.getter('ExecuteResponse["return"].root',!0)(e),t=q(pt.getter("Axes.Axis",!0)(e)),i={columns:{},rows:{}},o=0;t.length>o;o++)n=t[o],"sliceraxis"!==n["@name"].toLowerCase()&&(i.columns.tuples?i.rows=$(n):i.columns=$(n));return i},data:function(e){var t,n,i,o,r,s;for(e=pt.getter('ExecuteResponse["return"].root',!0)(e),t=q(pt.getter("CellData.Cell",!0)(e)),n=[],i=pt.getter("['@CellOrdinal']"),o=pt.getter("Value['#text']"),r=pt.getter("FmtValue['#text']"),s=0;t.length>s;s++)n.push({value:o(t[s]),fmtValue:r(t[s]),ordinal:parseInt(i(t[s]),10)});return n},_mapSchema:function(e,t){var n,i,o,r,s;for(e=pt.getter('DiscoverResponse["return"].root',!0)(e),n=q(pt.getter("row",!0)(e)),i=[],o=0;n.length>o;o++){r={};for(s in t)r[s]=t[s](n[o]);i.push(r)}return i},measures:function(e){return this._mapSchema(e,Z.measures)},kpis:function(e){return this._mapSchema(e,Z.kpis)},hierarchies:function(e){return this._mapSchema(e,Z.hierarchies)},levels:function(e){return this._mapSchema(e,Z.levels)},dimensions:function(e){return this._mapSchema(e,Z.dimensions)},cubes:function(e){return this._mapSchema(e,Z.cubes)},catalogs:function(e){return this._mapSchema(e,Z.catalogs)},members:function(e){return this._mapSchema(e,Z.members)}}),xt(!0,pt.data,{PivotDataSource:qt,XmlaTransport:K,XmlaDataReader:et,PivotCubeBuilder:jt,transports:{xmla:K},readers:{xmla:et}}),tt=function(e,t){if(!e)return null;for(var n=0,i=e.length;i>n;n++)if(e[n].field===t)return e[n];return null},nt=function(e,t){var n,i,o=[];for(n=0,i=e.length;i>n;n++)e[n].field!==t&&o.push(e[n]);return o},pt.ui.PivotSettingTarget=vt.extend({init:function(t,n){var i=this;vt.fn.init.call(i,t,n),i.element.addClass("k-pivot-setting"),i.dataSource=pt.data.PivotDataSource.create(n.dataSource),i._refreshHandler=e.proxy(i.refresh,i),i.dataSource.first(Ct,i._refreshHandler),n.template||(i.options.template="<div data-"+pt.ns+'name="${data.name || data}">${data.name || data}'+(i.options.enabled?'<a class="k-button k-button-icon k-button-bare"><span class="k-icon k-setting-delete"></span></a>':"")+"</div>"),i.template=pt.template(i.options.template),i.emptyTemplate=pt.template(i.options.emptyTemplate),i._sortable(),i.element.on("click"+Et,".k-button,.k-item",function(t){var n=e(t.target),o=n.closest("["+pt.attr("name")+"]").attr(pt.attr("name"));o&&(n.hasClass("k-setting-delete")?i.remove(o):i.options.sortable&&n[0]===t.currentTarget&&i.sort({field:o,dir:n.find(".k-i-sort-asc")[0]?"desc":"asc"}))}),(n.filterable||n.sortable)&&(i.fieldMenu=new gt.PivotFieldMenu(i.element,{messages:i.options.messages.fieldMenu,filter:".k-setting-fieldmenu",filterable:n.filterable,sortable:n.sortable,dataSource:i.dataSource})),i.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:!1,sortable:!1,emptyTemplate:"<div class='k-empty'>${data}</div>",setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(Ct,this._refreshHandler),this.dataSource=this.options.dataSource=e,this.fieldMenu&&this.fieldMenu.setDataSource(e),e.first(Ct,this._refreshHandler),this.refresh()},_sortable:function(){var e=this;e.options.enabled&&(this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,filter:">:not(.k-empty)",hint:e.options.hint,cursor:"move",start:function(e){e.item.focus().blur()},change:function(t){var n=t.item.attr(pt.attr("name"));"receive"==t.action?e.add(n):"remove"==t.action?e.remove(n):"sort"==t.action&&e.move(n,t.newIndex)}}).data("kendoSortable"))},_indexOf:function(e,t){var n,i,o=-1;for(n=0,i=t.length;i>n;n++)if(O(t[n])===e){o=n;break}return o},_isKPI:function(e){return"kpi"===e.type||e.measure},validate:function(e){var t,n,i=2==e.type||"aggregator"in e||this._isKPI(e);return i?"measures"===this.options.setting:"measures"===this.options.setting?i:(t=this.dataSource[this.options.setting](),n=e.defaultHierarchy||e.uniqueName,this._indexOf(n,t)>-1?!1:(t=this.dataSource["columns"===this.options.setting?"rows":"columns"](),this._indexOf(n,t)>-1?!1:!0))},add:function(t){var n,i,o=this.dataSource[this.options.setting]();for(t=e.isArray(t)?t.slice(0):[t],n=0,i=t.length;i>n;n++)-1!==this._indexOf(t[n],o)&&(t.splice(n,1),n-=1,i-=1);t.length&&(o=o.concat(t),this.dataSource[this.options.setting](o))},move:function(e,t){var n=this.dataSource[this.options.setting](),i=this._indexOf(e,n);i>-1&&(e=n.splice(i,1)[0],n.splice(t,0,e),this.dataSource[this.options.setting](n))},remove:function(e){var t=this.dataSource[this.options.setting](),n=this._indexOf(e,t);n>-1&&(t.splice(n,1),this.dataSource[this.options.setting](t))},sort:function(e){var t=this.options.sortable,n=t===!0||t.allowUnsort,i=n&&"asc"===e.dir,o=this.dataSource.sort()||[],r=nt(o,e.field);i&&o.length!==r.length&&(e=null),e&&r.push(e),this.dataSource.sort(r)},refresh:function(){var e,n="",i=this.dataSource[this.options.setting](),o=i.length,r=0;if(o)for(;o>r;r++)e=i[r],e=e.name===t?{name:e}:e,n+=this.template(xt({sortIcon:this._sortIcon(e.name)},e));else n=this.emptyTemplate(this.options.messages.empty);this.element.html(n)},destroy:function(){vt.fn.destroy.call(this),this.dataSource.unbind(Ct,this._refreshHandler),this.element.off(Et),this.sortable&&this.sortable.destroy(),this.fieldMenu&&this.fieldMenu.destroy(),this.element=null,this._refreshHandler=null},_sortIcon:function(e){var t=this.dataSource.sort(),n=tt(t,O(e)),i="";return n&&(i="k-i-sort-"+n.dir),i}}),it=vt.extend({init:function(n,i){var o,r,s=this;vt.fn.init.call(s,n,i),s._dataSource(),s._bindConfigurator(),s._wrapper(),s._createLayout(),s._columnBuilder=o=new dt,s._rowBuilder=r=new ht,s._contentBuilder=new ut,s._templates(),s.columnsHeader.add(s.rowsHeader).on("click","span.k-icon",function(){var n,i,a,l,c=e(this),d=o,h="expandColumn",u=c.attr(pt.attr("path")),f={axis:"columns",path:e.parseJSON(u)};c.parent().is("td")&&(d=r,h="expandRow",f.axis="rows"),i=c.hasClass(Ft),a=d.metadata[u],l=a.expanded===t,n=i?Lt:zt,s.trigger(n,f)||(d.metadata[u].expanded=!i,c.toggleClass(Ft,!i).toggleClass(Rt,i),!i&&l?s.dataSource[h](f.path):s.refresh())}),s._scrollable(),s.options.autoBind&&s.dataSource.fetch(),pt.notify(s)},events:[It,Bt,zt,Lt],options:{name:"PivotGrid",autoBind:!0,reorderable:!0,filterable:!1,sortable:!1,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,kpiStatusTemplate:null,kpiTrendTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var e=this.options.columnHeaderTemplate,t=this.options.rowHeaderTemplate,n=this.options.dataCellTemplate,i=this.options.kpiStatusTemplate,o=this.options.kpiTrendTemplate;this._columnBuilder.template=pt.template(e||Ot,{useWithBlock:!!e}),this._contentBuilder.dataTemplate=pt.template(n||Vt,{useWithBlock:!!n}),this._contentBuilder.kpiStatusTemplate=pt.template(i||Nt,{useWithBlock:!!i}),this._contentBuilder.kpiTrendTemplate=pt.template(o||Ht,{useWithBlock:!!o}),this._rowBuilder.template=pt.template(t||Ot,{useWithBlock:!!t})},_bindConfigurator:function(){var t=this.options.configurator;t&&e(t).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=e(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(e,t){var n,i=this._contentBuilder,o=i.columnIndexes[e||0],r=i.rowIndexes[t||0];return o&&r?(n=r.index*i.rowLength+o.index,{columnTuple:o.tuple,rowTuple:r.tuple,measure:o.measure||r.measure,dataItem:this.dataSource.view()[n]}):null},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.measuresTarget&&this.measuresTarget.setDataSource(e),this.rowsTarget&&this.rowsTarget.setDataSource(e),this.columnsTarget&&this.columnsTarget.setDataSource(e),this._bindConfigurator(),this.options.autoBind&&e.fetch()},setOptions:function(e){vt.fn.setOptions.call(this,e),this._templates()},_dataSource:function(){var t=this,n=t.options.dataSource;n=e.isArray(n)?{data:n}:n,t.dataSource&&this._refreshHandler?t.dataSource.unbind(Ct,t._refreshHandler).unbind(Dt,t._stateResetHandler).unbind(Tt,t._progressHandler).unbind(St,t._errorHandler):(t._refreshHandler=e.proxy(t.refresh,t),t._progressHandler=e.proxy(t._requestStart,t),t._stateResetHandler=e.proxy(t._stateReset,t),t._errorHandler=e.proxy(t._error,t)),t.dataSource=pt.data.PivotDataSource.create(n).bind(Ct,t._refreshHandler).bind(Tt,t._progressHandler).bind(Dt,t._stateResetHandler).bind(St,t._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_stateReset:function(){this._columnBuilder.reset(),this._rowBuilder.reset()},_wrapper:function(){var e=this.options.height;this.wrapper=this.element.addClass("k-widget k-pivot"),e&&this.wrapper.css("height",e)},_measureFields:function(){this.measureFields=e(Pt).addClass("k-pivot-toolbar k-header k-settings-measures"),this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(t,n){var i='<span tabindex="0" class="k-button" data-'+pt.ns+'name="${data.name}">${data.name}',o=n.sortable,r="";return o&&(r+="#if (data.sortIcon) {#",r+='<span class="k-icon ${data.sortIcon} k-setting-sort"></span>',r+="#}#"),(n.filterable||o)&&(r+='<span class="k-icon k-i-arrowhead-s k-setting-fieldmenu"></span>'),this.options.reorderable&&(r+='<span class="k-icon k-si-close k-setting-delete"></span>'),r&&(i+='<span class="k-field-actions">'+r+"</span>"),i+="</span>",new pt.ui.PivotSettingTarget(t,e.extend({template:i,emptyTemplate:'<span class="k-empty">${data}</span>',enabled:this.options.reorderable,dataSource:this.dataSource},n))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}}),this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var t=this,n=e(Ut),i=n.find(".k-pivot-rowheaders"),o=n.find(".k-pivot-table"),r=e(Pt).addClass("k-grid k-widget");t._measureFields(),t.columnFields=e(Pt).addClass("k-pivot-toolbar k-header k-settings-columns"),t.rowFields=e(Pt).addClass("k-pivot-toolbar k-header k-settings-rows"),t.columnsHeader=e('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />'),t.columnsHeader.parent().css("padding-right",pt.support.scrollbar()),t.rowsHeader=e('<div class="k-grid k-widget k-alt"/>'),t.content=e('<div class="k-grid-content" />'),i.append(t.measureFields),i.append(t.rowFields),i.append(t.rowsHeader),r.append(t.columnsHeader.parent()),r.append(t.content),o.append(t.columnFields),o.append(r),t.wrapper.append(n),t.columnsHeaderTree=new pt.dom.Tree(t.columnsHeader[0]),t.rowsHeaderTree=new pt.dom.Tree(t.rowsHeader[0]),t.contentTree=new pt.dom.Tree(t.content[0]),t._initSettingTargets()},_progress:function(e){pt.ui.progress(this.wrapper,e)},_resize:function(){this.columnsHeader.children("table"),this.content.children("table");this.content[0].firstChild&&(this._setSectionsWidth(),this._setSectionsHeight(),this._setContentWidth(),this._setContentHeight())},_setSectionsWidth:function(){var e=this.rowsHeader,t=e.parent(".k-pivot-rowheaders").width(At),n=Math.max(this.measureFields.outerWidth(),this.rowFields.outerWidth());n=Math.max(e.children("table").width(),n),t.width(n)},_setSectionsHeight:function(){var e=this.measureFields.height(At).height(),t=this.columnFields.height(At).height(),n=this.rowFields.height(At).innerHeight(),i=this.columnsHeader.height(At).innerHeight(),o=n-this.rowFields.height(),r=t>e?t:e,s=i>n?i:n;this.measureFields.height(r),this.columnFields.height(r),this.rowFields.height(s-o),this.columnsHeader.height(s)},_setContentWidth:function(){var e=this.content.find("table"),t=this.columnsHeader.children("table"),n=e.children("colgroup").children().length,i=n*this.options.columnWidth,o=Math.ceil(i/this.content.width()*100);100>o&&(o=100),e.add(t).css("width",o+"%"),this._resetColspan(t)},_setContentHeight:function(){var e=this,n=e.content,i=e.rowsHeader,o=e.wrapper.innerHeight(),r=pt.support.scrollbar(),s=n[0].offsetHeight===n[0].clientHeight,a=e.options.height;if(e.wrapper.is(":visible")){if(!o||!a)return s&&(r=0),n.height("auto"),i.height(n.height()-r),t;o-=e.columnFields.outerHeight(),o-=e.columnsHeader.outerHeight(),2*r>=o&&(o=2*r+1,s||(o+=r)),n.height(o),s&&(r=0),i.height(o-r)}},_resetColspan:function(e){var n=this,i=e.children("tbody").children(":first").children(":first");n._colspan===t&&(n._colspan=i.attr("colspan")),i.attr("colspan",1),clearTimeout(n._layoutTimeout),n._layoutTimeout=setTimeout(function(){i.attr("colspan",n._colspan),n._colspan=t})},_axisMeasures:function(e){var t=[],n=this.dataSource,i=n.measures(),o=i.length>1||i[0]&&i[0].type;return n.measuresAxis()===e&&(0===n[e]().length||o)&&(t=i),t},items:function(){return[]},refresh:function(){var e,t=this,n=t.dataSource,i=n.axes(),o=(i.columns||{}).tuples||[],r=(i.rows||{}).tuples||[],s=t._columnBuilder,a=t._rowBuilder,l={},c={};t.trigger(It,{action:"rebind"})||(s.measures=t._axisMeasures("columns"),t.columnsHeaderTree.render(s.build(o)),t.rowsHeaderTree.render(a.build(r)),l={indexes:s._indexes,measures:s.measures,metadata:s.metadata},c={indexes:a._indexes,measures:this._axisMeasures("rows"),metadata:a.metadata},t.contentTree.render(t._contentBuilder.build(n.view(),l,c)),t._resize(),t.touchScroller?t.touchScroller.contentResized():(e=pt.touchScroller(t.content),e&&e.movable&&(t.touchScroller=e,e.movable.bind("change",function(e){t.columnsHeader.scrollLeft(-e.sender.x),t.rowsHeader.scrollTop(-e.sender.y)}))),t._progress(!1),t.trigger(Bt))},_scrollable:function(){var t=this,n=t.columnsHeader,i=t.rowsHeader;t.content.scroll(function(){n.scrollLeft(this.scrollLeft),i.scrollTop(this.scrollTop)}),i.bind("DOMMouseScroll"+Et+" mousewheel"+Et,e.proxy(t._wheelScroll,t))},_wheelScroll:function(t){var n,i;t.ctrlKey||(n=pt.wheelDeltaY(t),i=this.content.scrollTop(),n&&(t.preventDefault(),e(t.currentTarget).one("wheel"+Et,!1),this.rowsHeader.scrollTop(i+-n),this.content.scrollTop(i+-n)))}}),ot=pt.dom.element,rt=pt.dom.html,st=pt.dom.text,at=function(e,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:e,parentMember:0!==t}},lt=function(e,t){for(var n=[],i=0;t>=i;i++)n.push(e.members[i].name);return n},ct=function(e,t){for(var n="",i=0;t>=i;i++)n+=e.members[i].name;return n},dt=mt.extend({init:function(){this.measures=1,this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[ot("table",null,[n,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(ot("col",null));return ot("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.map={},this.rows=[],this.rootTuple=t,this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(ot("tr",null,[ot("th",null,[rt("&nbsp;")])])),ot("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,o,r=this.rows,s=r.length,a=0;s>a;a++)if(e=r[a],1!==e.rowSpan)for(i=e.children,n=0,t=i.length;t>n;n++)o=i[n],o.tupleAll&&(o.attr.rowSpan=e.rowSpan)},_rowIndex:function(e){for(var t=this.rows,n=t.length,i=0;n>i&&t[i]!==e;i++);return i},_rowLength:function(){var e=this.rows[0]?this.rows[0].children:[],t=e.length,n=0,i=0;if(t)for(;t>i;i++)n+=e[i].attr.colSpan||1;return n||(n=this.measures),n},_row:function(e,t,n){var i,o,r=this.rootTuple.members[t].name,s=e.members[t].levelNum,a=r+s,l=this.map,c=l[a];return c?(c.notFirst=!1,c.parentMember&&c.parentMember===n||(c.parentMember=n,c.collapsed=0,c.colSpan=0)):(c=ot("tr",null,[]),c.parentMember=n,c.collapsed=0,c.colSpan=0,c.rowSpan=1,l[a]=c,i=l[r+(+s-1)],i&&(o=i.children,c.notFirst=o[1]&&-1===o[1].attr.className.indexOf("k-alt")?!0:i.notFirst),this.rows.splice(this._rowIndex(i)+1,0,c)),c},_measures:function(e,t,n){var i,o,r,s=this.map,a=s.measureRow;for(a||(a=ot("tr",null,[]),s.measureRow=a,this.rows.push(a)),o=0,r=e.length;r>o;o++)i=e[o],a.children.push(this._cell(n||"",[this._content(i,t)],i));return r},_content:function(e,t){return rt(this.template({member:e,tuple:t}))},_cell:function(e,t,n){var i=ot("th",{className:"k-header"+e},t);return i.value=n.caption||n.name,i},_buildRows:function(e,n,i){var o,r,s,a,l,c,d,h,u,f,p=e.members,g=p[n],m=p[n+1],v=[],_=0,w=0,y=0;if(g.measure)return this._measures(g.children,e),t;if(h=pt.stringify(lt(e,n)),o=this._row(e,n,i),s=g.children,a=s.length,u=this.metadata[h],u||(this.metadata[h]=u=at(+g.levelNum,n)),this._indexes.push({path:h,tuple:e}),g.hasChildren&&(u.expanded===!1&&(w=u.maxChildren,o.collapsed+=w,u.children=0,a=0),d={className:"k-icon "+(a?Ft:Rt)},d[pt.attr("path")]=h,v.push(ot("span",d))),v.push(this._content(g,e)),l=this._cell(o.notFirst?" k-first":"",v,g),o.children.push(l),o.colSpan+=1,a){for(c=this._cell(" k-alt",[this._content(g,e)],g),o.children.push(c);a>_;_++)r=this._buildRows(s[_],n,g);f=r.colSpan,w=r.collapsed,l.attr.colSpan=f,u.children=f,u.members=1,o.colSpan+=f,o.collapsed+=w,o.rowSpan=r.rowSpan+1,m&&(m.measure?f=this._measures(m.children,e," k-alt"):(r=this._buildRows(e,n+1),f=r.colSpan,o.collapsed+=r.collapsed,y=r.collapsed),c.attr.colSpan=f,f-=1,u.members+=f,o.colSpan+=f)}else m&&(m.measure?f=this._measures(m.children,e):(r=this._buildRows(e,n+1),f=r.colSpan,o.collapsed+=r.collapsed,y=r.collapsed),u.members=f,f>1&&(l.attr.colSpan=f,o.colSpan+=f-1));return u.members+y>u.maxMembers&&(u.maxMembers=u.members+y),s=u.children+w,s>u.maxChildren&&(u.maxChildren=s),(c||l).tupleAll=!0,o}}),ht=mt.extend({init:function(){this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[ot("table",null,[n,t])]},reset:function(){this.metadata={}},_rowLength:function(){for(var e=this.rows[0].children,t=0,n=0,i=e[n];i;)t+=i.attr.colSpan||1,i=e[++n];return t},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(ot("col",null));return ot("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.rootTuple=t,this.rows=[],this.map={},this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(ot("tr",null,[ot("td",null,[rt("&nbsp;")])])),ot("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,o=this.rows,r=o.length,s=0,a=this.rootTuple.members,l=a[0].name,c=a.length,d=0,h=this.map;r>s;s++)for(e=o[s],d=0;c>d;d++)n=this[a[d].name],t=e.colSpan["dim"+d],t&&n>t.levelNum&&(t.attr.colSpan=n-t.levelNum+1);e=h[l],i=h[l+"all"],e&&(e.children[0].attr.className="k-first"),i&&(i.children[0].attr.className+=" k-first")},_row:function(e){var t=ot("tr",null,e);return t.rowSpan=1,t.colSpan={},this.rows.push(t),t},_content:function(e,t){return rt(this.template({member:e,tuple:t}))},_cell:function(e,t,n){var i=ot("td",{className:e},t);return i.value=n.caption||n.name,i},_buildRows:function(e,t){var n,i,o,r,s,a,l,c,d,h=this.map,u=e.members,f=u[t],p=u[t+1],g=f.children,m=g.length,v=+f.levelNum+1,_=this.rootTuple.members[t].name,w=lt(e,t-1).join(""),y=w+(f.parentName||""),b=h[y+"all"]||h[y],x=[];if(!b||b.hasChild?b=this._row():b.hasChild=!0,f.measure){for(s=b.allCell?"k-grid-footer":"",b.children.push(this._cell(s,[this._content(g[0],e)],g[0])),b.rowSpan=m,d=1;m>d;d++)this._row([this._cell(s,[this._content(g[d],e)],g[d])]);return b}if(h[w+f.name]=b,n=pt.stringify(lt(e,t)),r=this.metadata[n],r||(this.metadata[n]=r=at(v-1,t)),this._indexes.push({path:n,tuple:e}),f.hasChildren&&(r.expanded===!1&&(m=0,r.children=0),a={className:"k-icon "+(m?Ft:Rt)},a[pt.attr("path")]=n,x.push(ot("span",a))),x.push(this._content(f,e)),s=b.allCell&&!m?"k-grid-footer":"",c=this._cell(s,x,f),c.levelNum=v,b.children.push(c),b.colSpan["dim"+t]=c,(!this[_]||v>this[_])&&(this[_]=v),m){for(b.allCell=!1,b.hasChild=!1,d=0;m>d;d++)i=this._buildRows(g[d],t),b!==i&&(b.rowSpan+=i.rowSpan);b.rowSpan>1&&(c.attr.rowSpan=b.rowSpan),r.children=b.rowSpan,l=this._cell("k-grid-footer",[this._content(f,e)],f),l.levelNum=v,o=this._row([l]),o.colSpan["dim"+t]=l,o.allCell=!0,h[w+f.name+"all"]=o,p&&(i=this._buildRows(e,t+1),l.attr.rowSpan=i.rowSpan),b.rowSpan+=o.rowSpan,r.members=o.rowSpan}else p&&(b.hasChild=!1,this._buildRows(e,t+1),(l||c).attr.rowSpan=b.rowSpan,r.members=b.rowSpan);return r.children>r.maxChildren&&(r.maxChildren=r.children),r.members>r.maxMembers&&(r.maxMembers=r.members),b}}),ut=mt.extend({init:function(){this.columnAxis={},this.rowAxis={}},build:function(e,n,i){var o,r,s=n.indexes[0],a=n.metadata[s?s.path:t];return this.columnAxis=n,this.rowAxis=i,this.data=e,this.rowLength=a?a.maxChildren+a.maxMembers:n.measures.length||1,this.rowLength||(this.rowLength=1),o=this._tbody(),r=this._colGroup(),[ot("table",null,[r,o])]},_colGroup:function(){var e=this.columnAxis.measures.length||1,t=[],n=0;for(this.rows[0]&&(e=this.rows[0].children.length);e>n;n++)t.push(ot("col",null));return ot("colgroup",null,t)},_tbody:function(){return this.rows=[],this.data[0]?(this.columnIndexes=this._indexes(this.columnAxis,this.rowLength),this.rowIndexes=this._indexes(this.rowAxis,Math.ceil(this.data.length/this.rowLength)),this._buildRows()):this.rows.push(ot("tr",null,[ot("td",null,[rt("&nbsp;")])])),ot("tbody",null,this.rows)},_indexes:function(e,n){var i,o,r,s,a,l=[],c=e.indexes,d=e.metadata,h=e.measures,u=h.length||1,f=0,p=0,g=0,m=c.length;if(!m){for(r=0;u>r;r++)l[r]={index:r,measure:h[r],tuple:null};return l}for(;m>g;g++){if(i=c[g],o=d[i.path],s=o.children+o.members,a=0,s&&(s-=u),o.expanded===!1&&o.children!==o.maxChildren&&(a=o.maxChildren),o.parentMember&&0===o.levelNum&&(s=-1),s>-1){for(r=0;u>r;r++)l[s+p+r]={children:s,index:f,measure:h[r],tuple:i.tuple},f+=1;for(;l[p]!==t;)p+=1}if(p===n)break;f+=a}return l},_buildRows:function(){for(var e=this.rowIndexes,t=e.length,n=0;t>n;n++)this.rows.push(this._buildRow(e[n]))},_buildRow:function(e){for(var t,n,i,o,r,s,a,l=e.index*this.rowLength,c=this.columnIndexes,d=c.length,h=[],u=0;d>u;u++)t=c[u],r={},t.children&&(r.className="k-alt"),o="",s=this.data[l+t.index],a=t.measure||e.measure,n={columnTuple:t.tuple,rowTuple:e.tuple,measure:a,dataItem:s},""!==s.value&&a&&a.type&&("status"===a.type?o=this.kpiStatusTemplate(n):"trend"===a.type&&(o=this.kpiTrendTemplate(n))),o||(o=this.dataTemplate(n)),i=ot("td",r,[rt(o)]),i.value=s.value,h.push(i);return r={},e.children&&(r.className="k-grid-footer"),ot("tr",r,h)}}),gt.plugin(it),pt.PivotExcelExporter=pt.Class.extend({init:function(e){this.options=e,this.widget=e.widget,this.dataSource=this.widget.dataSource},_columns:function(){var e,t=this.widget.columnsHeaderTree.children[0],n=this.widget.rowsHeaderTree.children[0],i=t.children[0].children.length,o=n.children[0].children.length,r=this.widget.options.columnWidth,s=[];if(o&&this.dataSource.data()[0])for(e=0;o>e;e++)s.push({autoWidth:!0});for(e=0;i>e;e++)s.push({autoWidth:!1,width:r});return s},_cells:function(e,t,n){for(var i,o,r,s,a,l=[],c=0,d=e.length;d>c;c++){for(o=[],r=e[c].children,i=r.length,s=0;i>s;s++)a=r[s],o.push({background:"#7a7a7a",color:"#fff",value:a.value,colSpan:a.attr.colSpan||1,rowSpan:a.attr.rowSpan||1});n&&n(o,c),l.push({cells:o,type:t})}return l},_rows:function(){var e,t,n=this.widget.columnsHeaderTree.children[0],i=this.widget.rowsHeaderTree.children[0],o=n.children[0].children.length,r=i.children[0].children.length,s=n.children[1].children,a=i.children[1].children,l=this.widget.contentTree.children[0].children[1].children,c=this._cells(s,"header");return r&&c[0].cells.splice(0,0,{background:"#7a7a7a",color:"#fff",value:"",colSpan:r,rowSpan:s.length}),e=function(e,t){for(var n,i,r=0,s=l[t].children;o>r;r++)n=s[r],i=+n.value,isNaN(i)&&(i=""),e.push({background:"#dfdfdf",color:"#333",value:i,colSpan:1,rowSpan:1})},t=this._cells(a,"data",e),c.concat(t)},_freezePane:function(){var e=this.widget.columnsHeaderTree.children[0],t=this.widget.rowsHeaderTree.children[0],n=t.children[0].children.length,i=e.children[1].children;return{colSplit:n,rowSplit:i.length}},workbook:function(){var t;return this.dataSource.view()[0]?(t=e.Deferred(),t.resolve()):t=this.dataSource.fetch(),t.then(e.proxy(function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:null}]}},this))}}),ft={extend:function(t){t.events.push("excelExport"),t.options.excel=e.extend(t.options.excel,this.options),t.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",filterable:!1,fileName:"Export.xlsx"},saveAsExcel:function(){var t=this.options.excel||{},n=new pt.PivotExcelExporter({widget:this});n.workbook().then(e.proxy(function(e){if(!this.trigger("excelExport",{workbook:e})){var n=new pt.ooxml.Workbook(e);pt.saveAs({dataURI:n.toDataURL(),fileName:e.fileName||t.fileName,proxyURL:t.proxyURL,forceProxy:t.forceProxy})}},this))}},pt.PivotExcelMixin=ft,pt.ooxml&&pt.ooxml.Workbook&&ft.extend(it.prototype),pt.PDFMixin&&(pt.PDFMixin.extend(it.prototype),it.fn._drawPDF=function(){return this._drawPDFShadow({width:this.wrapper.width()})})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});