/*
* Kendo UI v2015.2.624 (http://www.telerik.com/kendo-ui)
* Copyright 2015 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
* 若您需要使用Kendo UI Professional，请联系版权人获得合法的授权或许可。
*/
!function(e,define){define(["./kendo.dom.min","./kendo.touch.min","./kendo.draganddrop.min"],e)}(function(){return function(e){function t(e){return delete e.name,delete e.prefix,delete e.views,e}function n(e){var t=[],n=e.workWeekStart;for(t.push(n);e.workWeekEnd!=n;)n>6?n-=7:n++,t.push(n);return t}function i(){var t=kendo._activeElement();"body"!==t.nodeName.toLowerCase()&&e(t).blur()}var o,r,s=kendo.ui.Widget,a=kendo.dom.element,l=kendo.dom.text,c=e.isPlainObject,d=e.extend,h=e.proxy,u=kendo.support.browser,f=kendo.support.mobileOS,p=!1,g=kendo.keys,m=kendo.data.Query,v=".kendoGanttTimeline",_="click",y="dblclick",w="mousemove",b="mouseenter",x="mouseleave",k="keydown",C=".",S=kendo.template("#=kendo.toString(start, 't')#"),T=kendo.template("#=kendo.toString(start, 'ddd M/dd')#"),D=kendo.template("#=kendo.toString(start, 'ddd M/dd')# - #=kendo.toString(kendo.date.addDays(end, -1), 'ddd M/dd')#"),A=kendo.template("#=kendo.toString(start, 'MMM')#"),P=kendo.template("#=kendo.toString(start, 'yyyy')#"),M=kendo.template('<div class="#=styles.marquee#"><div class="#=styles.marqueeColor#"></div></div>'),E=kendo.template('<div style="z-index: 100002;" class="#=styles.tooltipWrapper#"><div class="#=styles.tooltipContent#"><div>#=messages.start#: #=kendo.toString(start, format)#</div><div>#=messages.end#: #=kendo.toString(end, format)#</div></div></div>'),I=kendo.template('<div style="z-index: 100002;" class="#=styles.tooltipWrapper#" ><div class="#=styles.tooltipContent#">#=text#%</div><div class="#=styles.tooltipCallout#" style="left:13px;"></div></div>'),B=kendo.template('<div class="#=styles.taskDetails#"><strong>#=task.title#</strong><div class="#=styles.taskDetailsPercent#">#=kendo.toString(task.percentComplete, "p0")#</div><ul class="#=styles.reset#"><li>#=messages.start#: #=kendo.toString(task.start, "h:mm tt ddd, MMM d")#</li><li>#=messages.end#: #=kendo.toString(task.end, "h:mm tt ddd, MMM d")#</li></ul></div>'),z={day:{type:"kendo.ui.GanttDayView"},week:{type:"kendo.ui.GanttWeekView"},month:{type:"kendo.ui.GanttMonthView"},year:{type:"kendo.ui.GanttYearView"}},L={alt:"k-alt",reset:"k-reset",nonWorking:"k-nonwork-hour",header:"k-header",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",tasksWrapper:"k-gantt-tables",rowsTable:"k-gantt-rows",columnsTable:"k-gantt-columns",tasksTable:"k-gantt-tasks",dependenciesWrapper:"k-gantt-dependencies",resource:"k-resource",resourceAlt:"k-resource k-alt",task:"k-task",taskSingle:"k-task-single",taskMilestone:"k-task-milestone",taskSummary:"k-task-summary",taskWrap:"k-task-wrap",taskMilestoneWrap:"k-milestone-wrap",resourcesWrap:"k-resources-wrap",taskDot:"k-task-dot",taskDotStart:"k-task-start",taskDotEnd:"k-task-end",taskDragHandle:"k-task-draghandle",taskContent:"k-task-content",taskTemplate:"k-task-template",taskActions:"k-task-actions",taskDelete:"k-task-delete",taskComplete:"k-task-complete",taskDetails:"k-task-details",taskDetailsPercent:"k-task-pct",link:"k-link",icon:"k-icon",iconDelete:"k-si-close",taskResizeHandle:"k-resize-handle",taskResizeHandleWest:"k-resize-w",taskResizeHandleEast:"k-resize-e",taskSummaryProgress:"k-task-summary-progress",taskSummaryComplete:"k-task-summary-complete",line:"k-line",lineHorizontal:"k-line-h",lineVertical:"k-line-v",arrowWest:"k-arrow-w",arrowEast:"k-arrow-e",dragHint:"k-drag-hint",dependencyHint:"k-dependency-hint",tooltipWrapper:"k-widget k-tooltip k-popup k-group k-reset",tooltipContent:"k-tooltip-content",tooltipCallout:"k-callout k-callout-s",callout:"k-callout",marquee:"k-marquee k-gantt-marquee",marqueeColor:"k-marquee-color"},R=kendo.ui.GanttView=s.extend({init:function(e,t){s.fn.init.call(this,e,t),this.title=this.options.title||this.options.name,this.header=this.element.find(C+R.styles.gridHeader),this.content=this.element.find(C+R.styles.gridContent),this.contentWidth=this.content.width(),this._workDays=n(this.options),this._headerTree=t.headerTree,this._taskTree=t.taskTree,this._dependencyTree=t.dependencyTree,this._taskCoordinates={},this._currentTime()},destroy:function(){s.fn.destroy.call(this),clearTimeout(this._tooltipTimeout),this.headerRow=null,this.header=null,this.content=null,this._dragHint=null,this._resizeHint=null,this._resizeTooltip=null,this._taskTooltip=null,this._percentCompleteResizeTooltip=null,this._headerTree=null,this._taskTree=null,this._dependencyTree=null},options:{showWorkHours:!1,showWorkDays:!1,workDayStart:new Date(1980,1,1,8,0,0),workDayEnd:new Date(1980,1,1,17,0,0),workWeekStart:1,workWeekEnd:5,hourSpan:1,slotSize:100,currentTimeMarker:{updateInterval:1e4}},renderLayout:function(){this._slots=this._createSlots(),this._tableWidth=this._calculateTableWidth(),this.createLayout(this._layout()),this._slotDimensions(),this._adjustHeight(),this.content.find(C+R.styles.dependenciesWrapper).width(this._tableWidth)},_adjustHeight:function(){this.content.height(this.element.height()-this.header.outerHeight())},createLayout:function(e){var t=this._headers(e),n=this._colgroup(),i=this._headerTree,o=a("thead",null,t),r=a("table",{style:{width:this._tableWidth+"px"}},[n,o]);i.render([r]),this.headerRow=this.header.find("table:first tr").last()},_slotDimensions:function(){var e,t,n,i,o=this.headerRow[0].children,r=this._timeSlots();for(n=0,i=o.length;i>n;n++)t=o[n],e=r[n],e.offsetLeft=t.offsetLeft,e.offsetWidth=t.offsetWidth},render:function(e){var t,n=e.length,i=R.styles,o=this._rowsTable(n),r=this._columnsTable(n),s=this._tasksTable(e),a=this.options.currentTimeMarker;this._taskTree.render([o,r,s]),t=this.content.find(C+i.rowsTable),this._contentHeight=t.height(),this._rowHeight=this._contentHeight/t.find("tr").length,this.content.find(C+i.columnsTable).height(this._contentHeight),a!==!1&&void 0!==a.updateInterval&&this._renderCurrentTime()},_rowsTable:function(e){var t,n,i=[],o=R.styles,r=[null,{className:o.alt}];for(n=0;e>n;n++)t=a("tr",r[n%2],[a("td",null,[l(" ")])]),i.push(t);return this._createTable(1,i,{className:o.rowsTable})},_columnsTable:function(){var e,t,n,i,o,r=[],s=R.styles,c=this._timeSlots(),d=c.length,h=0;for(o=0;d>o;o++)t=c[o],i={},n=t.span,h+=n,1!==n&&(i.colspan=n),t.isNonWorking&&(i.className=s.nonWorking),r.push(a("td",i,[l(" ")]));return e=a("tr",null,r),this._createTable(h,[e],{className:s.columnsTable})},_tasksTable:function(e){var t,n,i,o,r,s,l,c,d=[],h=R.styles,u=this._taskCoordinates={},f=this._calculateMilestoneWidth(),g=Math.round(f.width),m=this.options.resourcesField,v=[h.resource,h.resourceAlt],_=this._calculateResourcesMargin(),y=this._calculateTaskBorderWidth(),w=function(e){var t=i.left,n=t+i.width;o.isMilestone()&&(t-=g/2,n=t+g),u[o.id]={start:t,end:n,rowIndex:e}};for(l=0,c=e.length;c>l;l++)o=e[l],i=this._taskPosition(o),i.borderWidth=y,t=a("tr",null),n=a("td",null,[this._renderTask(e[l],i)]),o[m]&&o[m].length&&(r=p?this._tableWidth-i.left:Math.max(i.width||f.clientWidth,0)+i.left,s={width:this._tableWidth-(r+_)+"px"},s[p?"right":"left"]=r+"px",n.children.push(a("div",{className:h.resourcesWrap,style:s},this._renderResources(o[m],v[l%2])))),t.children.push(n),d.push(t),w(l);return this._createTable(1,d,{className:R.styles.tasksTable})},_createTable:function(e,t,n){var i,o,r,s=[];for(r=0;e>r;r++)s.push(a("col"));return i=a("colgroup",null,s),o=a("tbody",null,t),n.style||(n.style={}),n.style.width=this._tableWidth+"px",a("table",n,[i,o])},_calculateTableWidth:function(){var e,t,n,i,o=this._timeSlots(),r=0,s=0;for(n=0,i=o.length;i>n;n++)e=o[n].span,s+=e,e>r&&(r=e);return t=Math.round(s*this.options.slotSize/r)},_calculateMilestoneWidth:function(){var t,n,i=R.styles.task+" "+R.styles.taskMilestone,o=e("<div class='"+i+"' style='visibility: hidden; position: absolute'>");return this.content.append(o),n=o[0].getBoundingClientRect(),t={width:n.right-n.left,clientWidth:o[0].clientWidth},o.remove(),t},_calculateResourcesMargin:function(){var t,n=e("<div class='"+R.styles.resourcesWrap+"' style='visibility: hidden; position: absolute'>");return this.content.append(n),t=parseInt(n.css(p?"margin-right":"margin-left"),10),n.remove(),t},_calculateTaskBorderWidth:function(){var t,n,i=R.styles.task+" "+R.styles.taskSingle,o=e("<div class='"+i+"' style='visibility: hidden; position: absolute'>");return this.content.append(o),n=kendo.getComputedStyles(o[0],["border-left-width"]),t=parseFloat(n["border-left-width"],10),o.remove(),t},_renderTask:function(e,t){var n,i,o,r=this.options.editable,s=t.left,l=R.styles,c=l.taskWrap,d={};return e.summary?i=this._renderSummary(e,t):e.isMilestone()?(i=this._renderMilestone(e,t),c+=" "+l.taskMilestoneWrap):i=this._renderSingleTask(e,t),n=a("div",{className:c,style:{left:s+"px"}},[i]),r&&(n.children.push(a("div",{className:l.taskDot+" "+l.taskDotStart})),n.children.push(a("div",{className:l.taskDot+" "+l.taskDotEnd}))),e.summary||e.isMilestone()||!r||(o=Math.round(t.width*e.percentComplete),d[p?"right":"left"]=o+"px",n.children.push(a("div",{className:l.taskDragHandle,style:d}))),n},_renderSingleTask:function(e,t){var n,i=R.styles,o=Math.round(t.width*e.percentComplete),r=a("div",{className:i.taskContent},[a("div",{className:i.taskTemplate},[l(e.title)])]);return this.options.editable&&(r.children.push(a("span",{className:i.taskActions},[a("a",{className:i.link+" "+i.taskDelete,href:"#"},[a("span",{className:i.icon+" "+i.iconDelete})])])),r.children.push(a("span",{className:i.taskResizeHandle+" "+i.taskResizeHandleWest})),r.children.push(a("span",{className:i.taskResizeHandle+" "+i.taskResizeHandleEast}))),n=a("div",{className:i.task+" "+i.taskSingle,"data-uid":e.uid,style:{width:Math.max(t.width-2*t.borderWidth,0)+"px"}},[a("div",{className:i.taskComplete,style:{width:o+"px"}}),r])},_renderMilestone:function(e){var t=R.styles,n=a("div",{className:t.task+" "+t.taskMilestone,"data-uid":e.uid});return n},_renderSummary:function(e,t){var n=R.styles,i=Math.round(t.width*e.percentComplete),o=a("div",{className:n.task+" "+n.taskSummary,"data-uid":e.uid,style:{width:t.width+"px"}},[a("div",{className:n.taskSummaryProgress,style:{width:i+"px"}},[a("div",{className:n.taskSummaryComplete,style:{width:t.width+"px"}})])]);return o},_renderResources:function(e,t){var n,i,o,r=[];for(i=0,o=e.length;o>i;i++)n=e[i],r.push(a("span",{className:t,style:{color:n.get("color")}},[l(n.get("name"))]));return p&&r.reverse(),r},_taskPosition:function(e){var t=Math.round,n=t(this._offset(p?e.end:e.start)),i=t(this._offset(p?e.start:e.end));return{left:n,width:i-n}},_offset:function(e){var t,n,i,o,r=this._timeSlots(),s=0;return r.length?(o=this._slotIndex("start",e),t=r[o],e>t.end?s=t.offsetWidth:e>=t.start&&(n=e-t.start,i=t.end-t.start,s=n/i*t.offsetWidth),p&&(s=t.offsetWidth+1-s),t.offsetLeft+s):0},_slotIndex:function(e,t,n){var i,o=this._timeSlots(),r=0,s=o.length-1;n&&(o=[].slice.call(o).reverse());do i=Math.ceil((s+r)/2),t>o[i][e]?r=i:(i===s&&i--,s=i);while(r!==s);return n&&(r=o.length-1-r),r},_timeByPosition:function(t,n,i){var o,r,s,a=this._slotByPosition(t);return n?i?a.end:a.start:(o=t-e(C+R.styles.tasksTable).offset().left,r=a.end-a.start,s=o-a.offsetLeft,p&&(s=a.offsetWidth-s),new Date(a.start.getTime()+r*(s/a.offsetWidth)))},_slotByPosition:function(t){var n=t-e(C+R.styles.tasksTable).offset().left,i=this._slotIndex("offsetLeft",n,p);return this._timeSlots()[i]},_renderDependencies:function(e){var t,n,i=[],o=this._dependencyTree;for(t=0,n=e.length;n>t;t++)i.push.apply(i,this._renderDependency(e[t]));o.render(i)},_renderDependency:function(e){var t,n,i,o,r=this._taskCoordinates[e.predecessorId],s=this._taskCoordinates[e.successorId];if(!r||!s)return[];for(n="_render"+["FF","FS","SF","SS"][p?3-e.type:e.type],t=this[n](r,s),i=0,o=t.length;o>i;i++)t[i].attr["data-uid"]=e.uid;return t},_renderFF:function(e,t){var n=this._dependencyFF(e,t,!1);return n[n.length-1].children[0]=this._arrow(!0),n},_renderSS:function(e,t){var n=this._dependencyFF(t,e,!0);return n[0].children[0]=this._arrow(!1),n.reverse()},_renderFS:function(e,t){var n=this._dependencyFS(e,t,!1);return n[n.length-1].children[0]=this._arrow(!1),n},_renderSF:function(e,t){var n=this._dependencyFS(t,e,!0);return n[0].children[0]=this._arrow(!0),n.reverse()},_dependencyFF:function(e,t,n){var i,o=this,r=[],s=0,a=0,l=0,c=0,d=n?"start":"end",h=2,u=1,f=this._rowHeight,p=10,g=e.rowIndex*f+Math.floor(f/2)-1,m=t.rowIndex*f+Math.floor(f/2)-1,v=R.styles,_=function(){r.push(o._line(v.line+" "+v.lineHorizontal,{left:s+"px",top:a+"px",width:l+"px"}))},y=function(){r.push(o._line(v.line+" "+v.lineVertical,{left:s+"px",top:a+"px",height:c+"px"}))};return s=e[d],a=g,l=p,i=t[d]-e[d],i>0!==n&&(l=Math.abs(i)+p),n?(s-=l,l-=u,_()):(_(),s+=l-h),a>m?(c=a-m,c+=h,a=m,y()):(c=m-a,c+=h,y(),a+=c-h),l=Math.abs(s-t[d]),n||(l-=u,s-=l),_(),r},_dependencyFS:function(e,t,n){var i=this,o=[],r=0,s=0,a=0,l=0,c=this._rowHeight,d=Math.floor(c/2),h=10,u=2*h,f=t.start-e.end,p=2,g=1,m=e.rowIndex*c+Math.floor(c/2)-1,v=t.rowIndex*c+Math.floor(c/2)-1,_=R.styles,y=function(){o.push(i._line(_.line+" "+_.lineHorizontal,{left:r+"px",top:s+"px",width:a+"px"}))},w=function(){o.push(i._line(_.line+" "+_.lineVertical,{left:r+"px",top:s+"px",height:l+"px"}))};return r=e.end,s=m,a=h,n&&(r+=g,f>u&&(a=f-(h-p)),a-=g),y(),r+=a-p,u>=f&&(l=n?Math.abs(v-m)-d:d,m>v?(s-=l,l+=p,w()):(w(),s+=l),a=e.end-t.start+u,h>a&&(a=h),r-=a-p,y()),m>v?(l=s-v,s=v,l+=p,w()):(l=v-s,w(),s+=l),a=t.start-r,n||(a-=g),y(),o},_line:function(e,t){return a("div",{className:e,style:t})},_arrow:function(e){return a("span",{className:e?R.styles.arrowWest:R.styles.arrowEast})},_colgroup:function(){var e,t,n,i=this._timeSlots(),o=i.length,r=[];for(e=0;o>e;e++)for(t=0,n=i[e].span;n>t;t++)r.push(a("col"));return a("colgroup",null,r)},_createDragHint:function(e){this._dragHint=e.clone().addClass(R.styles.dragHint).css("cursor","move"),e.parent().append(this._dragHint)},_updateDragHint:function(e){var t=this._offset(e);this._dragHint.css({left:t})},_removeDragHint:function(){this._dragHint.remove(),this._dragHint=null},_createResizeHint:function(t){var n,i,o=R.styles,r=this._taskCoordinates[t.id].rowIndex*this._rowHeight,s=this.options,a=s.messages;this._resizeHint=e(M({styles:o})).css({top:0,height:this._contentHeight}),this.content.append(this._resizeHint),this._resizeTooltip=e(E({styles:o,start:t.start,end:t.end,messages:a.views,format:s.resizeTooltipFormat})).css({top:0,left:0}),this.content.append(this._resizeTooltip),this._resizeTooltipWidth=this._resizeTooltip.outerWidth(),n=this._resizeTooltip.outerHeight(),i=r-n,0>i&&(i=r+this._rowHeight),this._resizeTooltipTop=i},_updateResizeHint:function(t,n,i){var o=this._offset(p?n:t),r=this._offset(p?t:n),s=r-o,a=i!==p?o:r,l=this._tableWidth-kendo.support.scrollbar(),c=this._resizeTooltipWidth,d=this.options,h=d.messages,u=e(C+R.styles.tasksTable).offset().left-e(C+R.styles.tasksWrapper).offset().left;p&&(o+=u),this._resizeHint.css({left:o,width:s}),this._resizeTooltip&&this._resizeTooltip.remove(),a-=Math.round(c/2),0>a?a=0:a+c>l&&(a=l-c),p&&(a+=u),this._resizeTooltip=e(E({styles:R.styles,start:t,end:n,messages:h.views,format:d.resizeTooltipFormat})).css({top:this._resizeTooltipTop,left:a,"min-width":c}).appendTo(this.content)},_removeResizeHint:function(){this._resizeHint.remove(),this._resizeHint=null,this._resizeTooltip.remove(),this._resizeTooltip=null},_updatePercentCompleteTooltip:function(t,n,i){var o,r,s,a;this._removePercentCompleteTooltip(),o=this._percentCompleteResizeTooltip=e(I({styles:R.styles,text:i})).appendTo(this.element),r=Math.round(o.outerWidth()/2),s=o.find(C+R.styles.callout),a=Math.round(s.outerWidth()/2),o.css({top:t-(o.outerHeight()+a),left:n-r}),s.css("left",r-a)},_removePercentCompleteTooltip:function(){this._percentCompleteResizeTooltip&&this._percentCompleteResizeTooltip.remove(),this._percentCompleteResizeTooltip=null},_updateDependencyDragHint:function(e,t,n){this._removeDependencyDragHint(),n?this._creteVmlDependencyDragHint(e,t):this._creteDependencyDragHint(e,t)},_creteDependencyDragHint:function(t,n){var i=R.styles,o=n.x-t.x,r=n.y-t.y,s=Math.sqrt(o*o+r*r),a=Math.atan(r/o);0>o&&(a+=Math.PI),e("<div class='"+i.line+" "+i.lineHorizontal+" "+i.dependencyHint+"'></div>").css({top:t.y,left:t.x,width:s,"transform-origin":"0% 0","-ms-transform-origin":"0% 0","-webkit-transform-origin":"0% 0",transform:"rotate("+a+"rad)","-ms-transform":"rotate("+a+"rad)","-webkit-transform":"rotate("+a+"rad)"}).appendTo(this.content)},_creteVmlDependencyDragHint:function(t,n){var i=e("<kvml:line class='"+R.styles.dependencyHint+"' style='position:absolute; top: 0px; left: 0px;' strokecolor='black' strokeweight='2px' from='"+t.x+"px,"+t.y+"px' to='"+n.x+"px,"+n.y+"px'></kvml:line>").appendTo(this.content);i[0].outerHTML=i[0].outerHTML},_removeDependencyDragHint:function(){this.content.find(C+R.styles.dependencyHint).remove()},_createTaskTooltip:function(t,n,i){var o,r=R.styles,s=this.options,a=this.content,l=a.offset(),c=a.width(),d=a.scrollLeft(),h=e(n).parents("tr").first(),u=h.offset(),f=s.tooltip&&s.tooltip.template?kendo.template(s.tooltip.template):B,p=i-(l.left-a.scrollLeft()),g=u.top+h.outerHeight()-l.top+a.scrollTop(),m=this._taskTooltip=e('<div style="z-index: 100002;" class="'+r.tooltipWrapper+'" ><div class="'+r.taskContent+'"></div></div>');m.css({left:p,top:g}).appendTo(a).find(C+r.taskContent).append(f({styles:r,task:t,messages:s.messages.views})),m.outerHeight()<u.top-l.top&&m.css("top",u.top-l.top-m.outerHeight()+a.scrollTop()),o=m.outerWidth(),o+p-d>c&&(p-=o,d>p&&(p=d+c-(o+17)),m.css("left",p))},_removeTaskTooltip:function(){this._taskTooltip&&this._taskTooltip.remove(),this._taskTooltip=null},_scrollTo:function(e){var t=e.offset().left,n=e.width(),i=t+n,o=e.closest("tr"),r=o.offset().top,s=o.height(),a=r+s,l=this.content,c=l.offset(),d=c.top,h=l.height(),u=d+h,f=c.left,p=l.width(),g=f+p,m=kendo.support.scrollbar();d>r?l.scrollTop(l.scrollTop()+(r-d)):a>u&&l.scrollTop(l.scrollTop()+(a+m-u)),f>t&&n>p&&g>i||i>g&&p>n?l.scrollLeft(l.scrollLeft()+(i+m-g)):(i>g&&n>p&&t>f||f>t&&p>n)&&l.scrollLeft(l.scrollLeft()+(t-f))},_timeSlots:function(){return this._slots&&this._slots.length?this._slots[this._slots.length-1]:[]},_headers:function(e){var t,n,i,o,r,s,c,d,h=[],u=R.styles;for(r=0,s=e.length;s>r;r++){for(t=e[r],n=[],c=0,d=t.length;d>c;c++)i=t[c],o=l(i.text),n.push(a("th",{colspan:i.span,className:u.header+(i.isNonWorking?" "+u.nonWorking:"")},[o]));h.push(a("tr",null,n))}return h},_hours:function(e,t){var n,i,o,r=[],s=this.options,a=s.workDayStart.getHours(),l=s.workDayEnd.getHours(),c=s.hourSpan;for(e=new Date(e),t=new Date(t);t>e;)n=new Date(e),o=n.getHours(),i=o>=a&&l>o,n.setHours(n.getHours()+c),o==n.getHours()&&n.setHours(n.getHours()+2*c),(!s.showWorkHours||i)&&r.push({start:e,end:n,isNonWorking:!i,span:1}),e=n;return r},_days:function(e,t){var n,i,o=[];for(e=new Date(e),t=new Date(t);t>e;)n=kendo.date.nextDay(e),i=this._isWorkDay(e),(!this.options.showWorkDays||i)&&o.push({start:e,end:n,isNonWorking:!i,span:1}),e=n;return o},_weeks:function(e,t){var n,i,o,r=[],s=this.calendarInfo().firstDay;for(e=new Date(e),t=new Date(t);t>e;)n=kendo.date.dayOfWeek(kendo.date.addDays(e,1),s,1),n>t&&(n=t),i=this._days(e,n),o=i.length,o>0&&r.push({start:i[0].start,end:i[o-1].end,span:o}),e=n;return r},_months:function(e,t){var n,i,o,r=[];for(e=new Date(e),t=new Date(t);t>e;)n=new Date(e),n.setMonth(n.getMonth()+1),i=this._days(e,n),o=i.length,o>0&&r.push({start:i[0].start,end:i[o-1].end,span:o}),e=n;return r},_years:function(e,t){var n,i=[];for(e=new Date(e),t=new Date(t);t>e;)n=new Date(e),n.setFullYear(n.getFullYear()+1),i.push({start:e,end:n,span:12}),e=n;return i},_slotHeaders:function(e,t){var n,i,o,r=[];for(i=0,o=e.length;o>i;i++)n=e[i],r.push({text:t(n),isNonWorking:!!n.isNonWorking,span:n.span});return r},_isWorkDay:function(e){var t,n,i=e.getDay(),o=this._workDays;for(t=0,n=o.length;n>t;t++)if(o[t]===i)return!0;return!1},calendarInfo:function(){return kendo.getCulture().calendars.standard},_renderCurrentTime:function(){var t,n=this._getCurrentTime(),i=this._offset(n),o=e("<div class='k-current-time'></div>"),r=R.styles,s=e(C+r.tasksWrapper),a=e(C+r.tasksTable);this.content&&this._timeSlots().length&&(this.content.find(".k-current-time").remove(),t=this._timeSlots()[this._slotIndex("start",n)],t.start>n||n>t.end||(s.length&&a.length&&(i+=a.offset().left-s.offset().left),o.css({left:i+"px",top:"0px",width:"1px",height:this._contentHeight+"px"}).appendTo(this.content)))},_getCurrentTime:function(){return new Date},_currentTime:function(){var e=this.options.currentTimeMarker;e!==!1&&void 0!==e.updateInterval&&(this._renderCurrentTime(),this._currentTimeUpdateTimer=setInterval(h(this._renderCurrentTime,this),e.updateInterval))}});d(!0,R,{styles:L}),kendo.ui.GanttDayView=R.extend({name:"day",options:{timeHeaderTemplate:S,dayHeaderTemplate:T,resizeTooltipFormat:"h:mm tt ddd, MMM d"},range:function(e){this.start=kendo.date.getDate(e.start),this.end=kendo.date.getDate(e.end),(kendo.date.getMilliseconds(e.end)>0||this.end.getTime()===this.start.getTime())&&(this.end=kendo.date.addDays(this.end,1))},_createSlots:function(){var e,t,n,i,o=[],r=this._days(this.start,this.end),s=[];for(n=0,i=r.length;i>n;n++)e=r[n],t=this._hours(e.start,e.end),e.span=t.length,s.push.apply(s,t);return o.push(r),o.push(s),o},_layout:function(){var e=[],t=this.options;return e.push(this._slotHeaders(this._slots[0],kendo.template(t.dayHeaderTemplate))),e.push(this._slotHeaders(this._slots[1],kendo.template(t.timeHeaderTemplate))),e}}),kendo.ui.GanttWeekView=R.extend({name:"week",options:{dayHeaderTemplate:T,weekHeaderTemplate:D,resizeTooltipFormat:"h:mm tt ddd, MMM d"},range:function(e){var t=this.calendarInfo(),n=t.firstDay,i=e.end;n===i.getDay()&&i.setDate(i.getDate()+7),this.start=kendo.date.getDate(kendo.date.dayOfWeek(e.start,n,-1)),this.end=kendo.date.getDate(kendo.date.dayOfWeek(i,n,1))},_createSlots:function(){var e=[];return e.push(this._weeks(this.start,this.end)),e.push(this._days(this.start,this.end)),e},_layout:function(){var e=[],t=this.options;return e.push(this._slotHeaders(this._slots[0],kendo.template(t.weekHeaderTemplate))),e.push(this._slotHeaders(this._slots[1],kendo.template(t.dayHeaderTemplate))),e}}),kendo.ui.GanttMonthView=R.extend({name:"month",options:{weekHeaderTemplate:D,monthHeaderTemplate:A,resizeTooltipFormat:"dddd, MMM d, yyyy"},range:function(e){this.start=kendo.date.firstDayOfMonth(e.start),this.end=kendo.date.addDays(kendo.date.getDate(kendo.date.lastDayOfMonth(e.end)),1)},_createSlots:function(){var e=[];return e.push(this._months(this.start,this.end)),e.push(this._weeks(this.start,this.end)),e},_layout:function(){var e=[],t=this.options;return e.push(this._slotHeaders(this._slots[0],kendo.template(t.monthHeaderTemplate))),e.push(this._slotHeaders(this._slots[1],kendo.template(t.weekHeaderTemplate))),e}}),kendo.ui.GanttYearView=R.extend({name:"year",options:{yearHeaderTemplate:P,monthHeaderTemplate:A,resizeTooltipFormat:"dddd, MMM d, yyyy"},range:function(e){this.start=kendo.date.firstDayOfMonth(new Date(e.start.setMonth(0))),this.end=kendo.date.firstDayOfMonth(new Date(e.end.setMonth(12)))},_createSlots:function(){var t=[],n=this._months(this.start,this.end);return e(n).each(function(e,t){t.span=1}),t.push(this._years(this.start,this.end)),t.push(n),t},_layout:function(){var e=[],t=this.options;return e.push(this._slotHeaders(this._slots[0],kendo.template(t.yearHeaderTemplate))),e.push(this._slotHeaders(this._slots[1],kendo.template(t.monthHeaderTemplate))),e}}),o={wrapper:"k-timeline k-grid k-widget",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",gridContentWrap:"k-grid-content",tasksWrapper:"k-gantt-tables",dependenciesWrapper:"k-gantt-dependencies",task:"k-task",line:"k-line",taskResizeHandle:"k-resize-handle",taskResizeHandleWest:"k-resize-w",taskDragHandle:"k-task-draghandle",taskComplete:"k-task-complete",taskDelete:"k-task-delete",taskWrapActive:"k-task-wrap-active",taskWrap:"k-task-wrap",taskDot:"k-task-dot",taskDotStart:"k-task-start",taskDotEnd:"k-task-end",hovered:"k-state-hover",selected:"k-state-selected",origin:"k-origin"},r=kendo.ui.GanttTimeline=s.extend({init:function(e,t){s.fn.init.call(this,e,t),this.options.views&&this.options.views.length||(this.options.views=["day","week","month"]),p=kendo.support.isRtl(e),this._wrapper(),this._domTrees(),this._views(),this._selectable(),this._draggable(),this._resizable(),this._percentResizeDraggable(),this._createDependencyDraggable(),this._attachEvents(),this._tooltip()},options:{name:"GanttTimeline",messages:{views:{day:"Day",week:"Week",month:"Month",year:"Year",start:"Start",end:"End"}},snap:!0,selectable:!0,editable:!0},destroy:function(){s.fn.destroy.call(this),clearTimeout(this._tooltipTimeout),this._currentTimeUpdateTimer&&clearInterval(this._currentTimeUpdateTimer),this._unbindView(this._selectedView),this._moveDraggable&&this._moveDraggable.destroy(),this._resizeDraggable&&this._resizeDraggable.destroy(),this._percentDraggable&&this._percentDraggable.destroy(),this._dependencyDraggable&&this._dependencyDraggable.destroy(),this.touch&&this.touch.destroy(),this._headerTree=null,this._taskTree=null,this._dependencyTree=null,this.wrapper.off(v),kendo.destroy(this.wrapper)},_wrapper:function(){var e=r.styles;this.wrapper=this.element.addClass(e.wrapper).append("<div class='"+e.gridHeader+"'><div class='"+e.gridHeaderWrap+"'></div></div>").append("<div class='"+e.gridContentWrap+"'><div class='"+e.tasksWrapper+"'></div><div class='"+e.dependenciesWrapper+"'></div></div>")},_domTrees:function(){var e=r.styles,t=kendo.dom.Tree,n=this.wrapper;this._headerTree=new t(n.find(C+e.gridHeaderWrap)[0]),this._taskTree=new t(n.find(C+e.tasksWrapper)[0]),this._dependencyTree=new t(n.find(C+e.dependenciesWrapper)[0])},_views:function(){var e,t,n,i,o,r,s,a=this.options.views;for(this.views={},r=0,s=a.length;s>r;r++)e=a[r],t=c(e),t&&e.selectable===!1||(n=t?"string"!=typeof e.type?e.title:e.type:e,i=z[n],i&&(t&&(e.type=i.type),i.title=this.options.messages.views[n]),e=d({title:n},i,t?e:{}),n&&(this.views[n]=e,(!o||e.selected)&&(o=n)));o&&(this._selectedViewName=o)},view:function(e){return e&&(this._selectView(e),this.trigger("navigate",{view:e,action:"changeView"})),this._selectedView},_selectView:function(e){e&&this.views[e]&&(this._selectedView&&this._unbindView(this._selectedView),this._selectedView=this._initializeView(e),this._selectedViewName=e)},_viewByIndex:function(e){var t,n=this.views;for(t in n){if(!e)return t;e--}},_initializeView:function(e){var n,i=this.views[e];if(i){if(n=i.type,"string"==typeof n&&(n=kendo.getter(i.type)(window)),!n)throw Error("There is no such view");i=new n(this.wrapper,t(d(!0,{headerTree:this._headerTree,taskTree:this._taskTree,dependencyTree:this._dependencyTree},i,this.options)))}return i},_unbindView:function(e){e&&e.destroy()},_range:function(e){var t,n,i={field:"start",dir:"asc"},o={field:"end",dir:"desc"};return e&&e.length?(t=new m(e).sort(i).toArray()[0].start||new Date,n=new m(e).sort(o).toArray()[0].end||new Date,{start:new Date(t),end:new Date(n)}):{start:new Date,end:new Date}},_render:function(e){var t=this.view(),n=this._range(e);this._tasks=e,t.range(n),t.renderLayout(),t.render(e)},_renderDependencies:function(e){this.view()._renderDependencies(e)},_taskByUid:function(e){var t,n,i=this._tasks,o=i.length;for(n=0;o>n;n++)if(t=i[n],t.uid===e)return t},_draggable:function(){var e,t,n,o,s=this,a=this.options.snap,l=r.styles,c=function(){s.view()._removeDragHint(),e&&e.css("opacity",1),e=null,t=null,s.dragInProgress=!1};this.options.editable&&(this._moveDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:C+l.task,holdToDrag:kendo.support.mobileOS,ignore:C+l.taskResizeHandle}),this._moveDraggable.bind("dragstart",function(i){var r=s.view();return e=i.currentTarget.parent(),t=s._taskByUid(i.currentTarget.attr("data-uid")),s.trigger("moveStart",{task:t})?void i.preventDefault():(n=t.start,o=r._timeByPosition(i.x.location,a)-n,r._createDragHint(e),e.css("opacity",.5),clearTimeout(s._tooltipTimeout),void(s.dragInProgress=!0))}).bind("drag",kendo.throttle(function(e){var i,r,l;s.dragInProgress&&(i=s.view(),r=new Date(i._timeByPosition(e.x.location,a)-o),l=r,s.trigger("move",{task:t,start:r})||(n=r,p&&(l=new Date(n.getTime()+t.duration())),i._updateDragHint(l)))},15)).bind("dragend",function(){s.trigger("moveEnd",{task:t,start:n}),c()}).bind("dragcancel",function(){c()}).userEvents.bind("select",function(){i()}))},_resizable:function(){var e,t,n,o,s,a=this,l=this.options.snap,c=r.styles,d=function(){a.view()._removeResizeHint(),e=null,t=null,a.dragInProgress=!1};this.options.editable&&(this._resizeDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:C+c.taskResizeHandle,holdToDrag:!1}),this._resizeDraggable.bind("dragstart",function(i){return s=i.currentTarget.hasClass(c.taskResizeHandleWest),p&&(s=!s),e=i.currentTarget.closest(C+c.task),t=a._taskByUid(e.attr("data-uid")),a.trigger("resizeStart",{task:t})?void i.preventDefault():(n=t.start,o=t.end,a.view()._createResizeHint(t),clearTimeout(a._tooltipTimeout),void(a.dragInProgress=!0))}).bind("drag",kendo.throttle(function(e){var i,r;a.dragInProgress&&(i=a.view(),r=i._timeByPosition(e.x.location,l,!s),s?n=o>r?r:o:o=r>n?r:n,a.trigger("resize",{task:t,start:n,end:o})||i._updateResizeHint(n,o,s))},15)).bind("dragend",function(){a.trigger("resizeEnd",{task:t,resizeStart:s,start:n,end:o}),d()}).bind("dragcancel",function(){d()}).userEvents.bind("select",function(){i()}))},_percentResizeDraggable:function(){var e,t,n,o,s,a,l,c,d,h,u=this,f=r.styles,g=function(){u.view()._removePercentCompleteTooltip(),t=null,e=null,u.dragInProgress=!1},m=function(e){t.find(C+f.taskComplete).width(e).end().siblings(C+f.taskDragHandle).css(p?"right":"left",e)};this.options.editable&&(this._percentDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:C+f.taskDragHandle,holdToDrag:!1}),this._percentDraggable.bind("dragstart",function(i){t=i.currentTarget.siblings(C+f.task),e=u._taskByUid(t.attr("data-uid")),l=e.percentComplete,n=t.offset(),o=this.element.offset(),s=t.find(C+f.taskComplete).width(),a=t.outerWidth(),clearTimeout(u._tooltipTimeout),u.dragInProgress=!0}).bind("drag",kendo.throttle(function(e){if(u.dragInProgress){h=p?-e.x.initialDelta:e.x.initialDelta;var t=Math.max(0,Math.min(a,s+h));l=Math.round(t/a*100),m(t),c=n.top-o.top,d=n.left+t-o.left,p&&(d+=a-2*t),u.view()._updatePercentCompleteTooltip(c,d,l)}},15)).bind("dragend",function(){u.trigger("percentResizeEnd",{task:e,percentComplete:l/100}),g()}).bind("dragcancel",function(){m(s),g()}).userEvents.bind("select",function(){i()}))},_createDependencyDraggable:function(){var t,n,o,s=this,a=e(),l=e(),c=u.msie&&9>u.version,d=r.styles,h=function(){t.css("display","").removeClass(d.hovered),t.parent().removeClass(d.origin),t=null,f(!1),l=e(),a=e(),s.view()._removeDependencyDragHint(),s.dragInProgress=!1},f=function(e){l.hasClass(d.origin)||(l.find(C+d.taskDot).css("display",e?"block":""),a.toggleClass(d.hovered,e))};this.options.editable&&(c&&document.namespaces&&document.namespaces.add("kvml","urn:schemas-microsoft-com:vml","#default#VML"),this._dependencyDraggable=new kendo.ui.Draggable(this.wrapper,{distance:0,filter:C+d.taskDot,holdToDrag:!1}),this._dependencyDraggable.bind("dragstart",function(i){var r,a;t=i.currentTarget.css("display","block").addClass(d.hovered),t.parent().addClass(d.origin),r=t.offset(),a=e(C+d.tasksWrapper).offset(),n=Math.round(r.left-a.left+t.outerHeight()/2),o=Math.round(r.top-a.top+t.outerWidth()/2),clearTimeout(s._tooltipTimeout),s.dragInProgress=!0}).bind("drag",kendo.throttle(function(t){var i,r,h,u;s.dragInProgress&&(s.view()._removeDependencyDragHint(),i=e(kendo.elementUnderCursor(t)),r=e(C+d.tasksWrapper).offset(),h=t.x.location-r.left,u=t.y.location-r.top,s.view()._updateDependencyDragHint({x:n,y:o},{x:h,y:u},c),f(!1),a=i.hasClass(d.taskDot)?i:e(),l=i.closest(C+d.taskWrap),f(!0))},15)).bind("dragend",function(){var e,n,i,o,r;a.length&&(e=t.hasClass(d.taskDotStart),n=a.hasClass(d.taskDotStart),i=e?n?3:2:n?1:0,o=s._taskByUid(t.siblings(C+d.task).attr("data-uid")),r=s._taskByUid(a.siblings(C+d.task).attr("data-uid")),o!==r&&s.trigger("dependencyDragEnd",{type:i,predecessor:o,successor:r})),h()
}).bind("dragcancel",function(){h()}).userEvents.bind("select",function(){i()}))},_selectable:function(){var t=this,n=r.styles;this.options.selectable&&this.wrapper.on(_+v,C+n.task,function(n){n.stopPropagation(),n.ctrlKey?t.trigger("clear"):t.trigger("select",{uid:e(this).attr("data-uid")})}).on(_+v,C+n.taskWrap,function(t){t.stopPropagation(),e(this).css("z-index","0");var i=e(document.elementFromPoint(t.clientX,t.clientY));i.hasClass(n.line)&&i.click(),e(this).css("z-index","")}).on(_+v,C+n.tasksWrapper,function(){t.selectDependency().length>0?t.clearSelection():t.trigger("clear")}).on(_+v,C+n.line,function(e){e.stopPropagation(),t.selectDependency(this)})},select:function(e){var t=this.wrapper.find(e),n=r.styles;return t.length?(this.clearSelection(),t.addClass(n.selected),void(kendo.support.mobileOS&&t.parent().addClass(n.taskWrapActive))):this.wrapper.find(C+n.task+C+n.selected)},selectDependency:function(t){var n,i=this.wrapper.find(t),o=r.styles;return i.length?(this.clearSelection(),this.trigger("clear"),n=e(i).attr("data-uid"),void this.wrapper.find(C+o.line+"[data-uid='"+n+"']").addClass(o.selected)):this.wrapper.find(C+o.line+C+o.selected)},clearSelection:function(){var e=r.styles;this.wrapper.find(C+e.selected).removeClass(e.selected),kendo.support.mobileOS&&this.wrapper.find(C+e.taskWrapActive).removeClass(e.taskWrapActive)},_attachEvents:function(){var t=this,n=r.styles;this.options.editable&&(this._tabindex(),this.wrapper.on(_+v,C+n.taskDelete,function(i){t.trigger("removeTask",{uid:e(this).closest(C+n.task).attr("data-uid")}),i.stopPropagation(),i.preventDefault()}).on(k+v,function(e){var n;e.keyCode===g.DELETE&&(n=t.selectDependency(),n.length&&(t.trigger("removeDependency",{uid:n.attr("data-uid")}),t.clearSelection()))}),f?this.touch=this.wrapper.kendoTouch({filter:C+n.task,doubletap:function(n){t.trigger("editTask",{uid:e(n.touch.currentTarget).attr("data-uid")})}}).data("kendoTouch"):this.wrapper.on(y+v,C+n.task,function(n){t.trigger("editTask",{uid:e(this).attr("data-uid")}),n.stopPropagation(),n.preventDefault()}))},_tooltip:function(){var t,n=this,i=this.options.tooltip,o=r.styles,s=function(e){t=e.clientX};i&&i.visible===!1||this.wrapper.on(b+v,C+o.task,function(){var i=this,o=n._taskByUid(e(this).attr("data-uid"));n.dragInProgress||(n._tooltipTimeout=setTimeout(function(){n.view()._createTaskTooltip(o,i,t)},800),e(this).on(w,s))}).on(x+v,C+o.task,function(){clearTimeout(n._tooltipTimeout),n.view()._removeTaskTooltip(),e(this).off(w,s)})}}),d(!0,r,{styles:o})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});